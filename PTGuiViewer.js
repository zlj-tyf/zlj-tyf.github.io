/*
PTGuiViewer version 2.5

See below for usage instructions!

PTGui Panorama Viewer, a combined Flash10 / CSS3 / WebGL viewer for spherical panoramas. 
(C) Copyright New House Internet Services BV 2010 - 2019
Website: http://www.ptgui.com/

License Agreement for PTGui Panorama Viewer

The software program PTGui Panorama Viewer ("PTGuiViewer") is licensed, not 
sold. By copying, publishing or distributing PTGuiViewer you agree to be bound 
by the terms of this agreement. If you do not agree to the terms of this 
agreement, you are not permitted to copy, publish or distribute PTGuiViewer.

1. Grant of a Limited License 

New House Internet Services B.V. ("NHIS") grants you ("Licensee") a non-exclusive, 
non-transferable Limited License ("License"). The License permits Licensee to 
include the files PTGuiViewer.js and PTGuiViewer.swf on any number of websites, 
provided that all of the following conditions are satisfied: 
- PTGuiViewer may only be used to display panoramic images created with
PTGui panoramic stitching software ("PTGui") by a licensee of PTGui,  
and 
- PTGuiViewer.js and PTGuiViewer.swf may only be published unmodified, as 
released by NHIS 

2. Ownership.

You acknowledge that NHIS and its licensors retain ownership of PTGuiViewer. 
NHIS reserves any rights not expressly granted to you. The rights granted are 
limited to NHIS's and its licensors' intellectual property rights in 
PTGuiViewer and do not include any other patents or intellectual property 
rights.

3. Transfer Restriction

You may not transfer or assign your rights under this License Agreement to 
another party without NHIS's prior written consent.

4. Support

You are welcome to post technical support questions to the PTGui Support 
forum. However, this license does not obligate NHIS to provide technical 
support.

5. Limitations

YOU MAY NOT REVERSE ENGINEER, DECOMPILE OR DISASSEMBLE PTGUIVIEWER, EXCEPT AND 
ONLY TO THE EXTENT EXPRESSLY PERMITTED BY APPLICABLE LAW. YOU MAY NOT MODIFY, 
ADAPT, TRANSLATE, RENT, LEASE, LOAN OR CREATE DERIVATIVE WORKS BASED UPON 
PTGUIVIEWER OR ANY PART THEREOF.

6. Restricted Uses

PTGUIVIEWER IS NOT INTENDED FOR USE IN THE OPERATION OF NUCLEAR FACILITIES, 
AIRCRAFT NAVIGATION OR COMMUNICATION SYSTEMS, AIR TRAFFIC CONTROL SYSTEMS, 
LIFE SUPPORT MACHINES OR OTHER EQUIPMENT IN WHICH THE FAILURE OF PTGUIVIEWER 
COULD LEAD TO DEATH, PERSONAL INJURY, OR SEVERE PHYSICAL OR ENVIRONMENTAL 
DAMAGE.

7. Limited Warranty

NHIS warrants for a period of thirty (30) days from the date of purchase of 
your License that PTGuiViewer as provided by NHIS will perform substantially 
in accordance with the accompanying documentation. NHIS's entire liability and 
your sole and exclusive remedy for any breach of the foregoing limited 
warranty will be, at NHIS's option, replacement of PTGuiViewer, refund of the 
purchase price or repair or replacement of PTGuiViewer which is returned to 
NHIS or an NHIS authorized representative with a copy of the receipt. THIS 
LIMITED WARRANTY IS THE ONLY WARRANTY PROVIDED BY NHIS AND NHIS AND ITS 
LICENSORS EXPRESSLY DISCLAIM ALL OTHER WARRANTIES, CONDITIONS OR OTHER TERMS, 
EITHER EXPRESS OR IMPLIED (WHETHER COLLATERALLY, BY STATUTE OR OTHERWISE), 
INCLUDING BUT NOT LIMITED TO IMPLIED WARRANTIES, CONDITIONS OR OTHER TERMS OF 
MERCHANTABILITY, SATISFACTORY QUALITY AND/OR FITNESS FOR A PARTICULAR PURPOSE 
WITH REGARD TO PTGUIVIEWER AND ACCOMPANYING WRITTEN MATERIALS. FURTHERMORE, 
THERE IS NO WARRANTY AGAINST INTERFERENCE WITH YOUR ENJOYMENT OF PTGUIVIEWER 
OR AGAINST INFRINGEMENT OF THIRD PARTY PROPRIETARY RIGHTS BY PTGUIVIEWER. NHIS 
DOES NOT WARRANT THAT THE OPERATION OF PTGUIVIEWER WILL BE UNINTERRUPTED OR 
ERROR-FREE, OR THAT DEFECTS IN PTGUIVIEWER WILL BE CORRECTED. NO ORAL OR 
WRITTEN INFORMATION OR ADVICE GIVEN BY NHIS OR AN NHIS AUTHORIZED 
REPRESENTATIVE SHALL CREATE A WARRANTY. BECAUSE SOME JURISDICTIONS DO NOT 
ALLOW THE EXCLUSION OR LIMITATION OF IMPLIED WARRANTIES, CONDITIONS OR OTHER 
TERMS THE ABOVE LIMITATION MAY NOT APPLY TO YOU. THE TERMS OF THIS DISCLAIMER 
AND THE LIMITED WARRANTY UNDER THIS SECTION DO NOT AFFECT OR PREJUDICE THE 
STATUTORY RIGHTS OF A CONSUMER ACQUIRING PTGUIVIEWER OTHERWISE THAN IN THE 
COURSE OF A BUSINESS, NEITHER DO THEY LIMIT OR EXCLUDE ANY LIABILITY FOR DEATH 
OR PERSONAL INJURY CAUSED BY NHIS'S NEGLIGENCE.

8. Exclusion and Limitation of Remedies and Damages.

IN NO EVENT WILL NHIS, ITS PARENTS, SUBSIDIARIES, OR ANY OF THEIR LICENSORS, 
DIRECTORS, OFFICERS, EMPLOYEES OR AFFILIATES OF ANY OF THE FOREGOING BE LIABLE 
TO ANY OTHER PARTY FOR ANY CONSEQUENTIAL, INCIDENTAL, INDIRECT OR SPECIAL 
DAMAGES WHATSOEVER (INCLUDING WITHOUT LIMITATION, DAMAGES FOR LOSS OF BUSINESS 
PROFITS, BUSINESS INTERRUPTION, LOSS OF DATA, LOSS OF BUSINESS INFORMATION AND 
THE LIKE) OR DIRECT LOSS OF BUSINESS, BUSINESS PROFITS OR REVENUE, WHETHER 
FORESEEABLE OR UNFORESEEABLE, ARISING OUT OF THE USE OF OR INABILITY TO USE 
PTGUIVIEWER OR ACCOMPANYING WRITTEN MATERIALS, REGARDLESS OF THE BASIS OF THE 
CLAIM (WHETHER UNDER CONTRACT, NEGLIGENCE OR OTHER TORT OR UNDER STATUTE OR 
OTHERWISE HOWSOEVER ARISING) AND EVEN IF ADVISED OF THE POSSIBILITY OF SUCH 
DAMAGE.

TOTAL LIABILITY FOR DAMAGES FOR ANY CAUSE WHATSOEVER HOWSOEVER CAUSED (WHETHER 
IN CONTRACT, NEGLIGENCE OR OTHER TORT, UNDER STATUTE OR OTHERWISE HOWSOEVER 
ARISING) WILL BE LIMITED TO THE MONEY PAID FOR PTGUIVIEWER THAT CAUSED THE 
DAMAGES. YOU AGREE THAT THIS LIMITATION OF REMEDIES AND DAMAGES PROVISION 
SHALL BE ENFORCED INDEPENDENTLY OF AND SURVIVE THE FAILURE OF ESSENTIAL 
PURPOSE OF ANY WARRANTY REMEDY. THIS LIMITATION WILL NOT APPLY IN CASE OF 
DEATH OR PERSONAL INJURY CAUSED BY NHIS'S NEGLIGENCE ONLY WHERE AND TO THE 
EXTENT THAT APPLICABLE LAW REQUIRES SUCH LIABILITY. BECAUSE SOME JURISDICTIONS 
DO NOT ALLOW THE EXCLUSION OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR 
INCIDENTAL DAMAGES, THE LIMITATION OF LIABILITY IN THIS SECTION MAY NOT APPLY 
TO YOU. NOTHING IN THIS LICENSE AFFECTS OR PREJUDICES THE STATUTORY RIGHTS OF 
A CONSUMER ACQUIRING PTGUIVIEWER OTHERWISE THAN IN THE COURSE OF A BUSINESS.

9. General Terms

This License shall be governed by the laws of The Netherlands. Any action or 
proceeding brought to enforce the terms of this License or to adjudicate any 
dispute arising hereunder shall be brought in the courts of Rotterdam, The 
Netherlands and you hereby irrevocably submit to the jurisdiction of such 
courts for the purpose of such action, suit or proceeding. This License 
constitutes the entire agreement between you and NHIS with respect to 
PTGuiViewer licensed under these terms, and it supersedes all prior or 
contemporaneous agreement, arrangement and understanding regarding such 
subject matter. You acknowledge and agree that you have not relied on any 
representations made by NHIS, however, nothing in this License shall limit or 
exclude liability for any representation made fraudulently. No amendment to or 
modification of this License will be binding unless in writing and signed by 
NHIS. If any provision of this License shall be held by a court of competent 
jurisdiction to be contrary to law, that provision will be enforced to the 
maximum extent permissible, and the remaining provisions of this License will 
remain in full force and effect. No failure or delay by NHIS in exercising its 
rights or remedies shall operate as a waiver unless made by specific written 
notice. No single or partial exercise of any right or remedy of NHIS shall 
operate as a waiver or preclude any other or further exercise of that or any 
other right or remedy.

------------------------ USAGE: ------------------------

Quick start: include the following code in the <head> of your HTML file:


<script type="text/javascript" src="PTGuiViewer.js"></script>
<script type="text/javascript">
var viewer=new PTGuiViewer();
viewer.setSwfUrl("PTGuiViewer.swf");
viewer.preferHtmlViewer();
// or viewer.preferFlashViewer()
viewer.setVars({
  pano: "myimage",
  format: "14faces",
});
viewer.embed("mypanoviewer");
</script>

And in the <body> include:
<div id="mypanoviewer"></div>


The viewer will be embedded as child of the above <div>, and it will use the
images myimage00.jpg ... myimage14.jpg. 

Details:
viewer.setSwfUrl(url)
Point to the location of the accompanying file PTGuiViewer.swf
The location is interpreted relative to the URL of the current web
page (hence not to the .js location).

The PTGui Viewer supports 3 technologies: Flash10, CSS3D and WebGL. 
The Flash10 viewer is available on all browsers with the Flash version 10 plugin
installed. 
CSS3D works (as of feb 2011) on Apple's Safari 5 and IOS (iPhone/iPad/iPod).
WebGL is supported (as of feb 2011) on Chrome 9 and Firefox 4.  

viewer.preferHtmlViewer()
viewer.preferFlashViewer()
These functions determine which technology will be used if the browser supports 
both the native (CSS3D or WebGL) viewer and Flash10. 

viewer.setVars()
Pass an array with the following key/value pairs:
- pano (required): the relative url of the panoramic tiles. The viewer appends
the suffixes 00.jpg through 14.jpg.
- format (required): format of the panoramic tiles. Currently only the '14faces'
format is supported (as produced by PTGui). Future versions of the viewer may
support other formats, therefore this option is required for future 
compatibility.
- pan, tilt, fov: initial viewing parameters. Pan rotates in horizontal direction,
tilt is up/down. Fov is the diagonal field of view angle.
- maxpan, maxtilt, maxfov, minpan, mintilt, minfov: Maximum and minimum limits
for pan/tilt/fov.
- autorotatespeed: speed (in degrees per second) for automatic rotation. If set
to 0, autorotate is disabled. Autorotation starts immediately upon loading the
panorama and ends when the user clicks in the panorama.
- autorotatedelay: If nonzero, autorotation is resumed .. seconds after the user
has released the mouse
- autorotatetohorizon: true or false (default is true)
If true, when autorotation is started the viewer navigates to the horizon. If 
false, the viewer will stay at the current tilt angle when autorotation starts.
- maxiosdimension: Limit the tile size on Apple iOS devices.
If a too large panorama is shown on an iPad/iPhone/iPod, the Safari browser will
crash because it runs out of memory. This setting limits reduces the tile size
on these devices. The recommended (and default) value is 400. 
- showfullscreenbutton_flash: true or false
Sets whether the fullscreen button is visible in the Flash viewer
- showfullscreenbutton_html: true or false
Sets whether the fullscreen button is visible in the HTML viewer
(HTML viewer does not support true full screen viewing due to restrictions in the
HTML standard. Clicking the fullscreen button enlarges the viewer to the full
browser window size.)
- enablegyroscope: true or false
On devices with a gyroscope (iPhone 4 or iPad 2) the viewer can look around in
the panorama by rotating the device. Enabled or disabled by this setting.
- enablemactouchpad: true or false (default is true)
On a mac, enable navigating the panorama by swiping with two fingers on the 
touchpad, or swiping with one finger on the magic mouse. Zooming on a touchpad
is done by clicking with two fingers on the touchpad, holding down and dragging.
With the magic mouse zooming is done by clicking on the right half of the mouse
button, holding down and dragging.
If this is set to false, swiping with two fingers on the touchpad, or swiping with
one finger on the magic mouse, performs zooming.
- mousemode: 'drag' or 'moveto'
Controls the navigation mode on non-mobile devices. If 'drag' is selected, the
panorama is navigated by click&dragging (swiping). 'moveto' will contiuously move
the panorama while holding down the mouse. On mobile devices the panorama is always 
navigated by dragging/swiping, regardless of this setting.

viewer.setFlashObjectParams()
Allows adding custom parameters for the Flash object/embed tag. For example:
viewer.setFlashObjectParams({
  wmode: "opaque"
});
will add a <param name="wmode" value="opaque"> to the Flash <object> tag
and a parameter in the Flash <embed> tag: <embed ... wmode="opaque" ...>
Only used for the Flash viewer, ignored when using CSS3D or WebGL. 

viewer.embed(container)
Embeds the viewer as a child of the given container. All contents of the 
container element is cleared, and the viewer will make itself a child element
of the container.
The container can be either an html element object (as returned by 
document.getElementById) or a string representing the id of the container
element.
If embed() is called before the page has finished loading, the embedding
will be done as soon as the page has finished loading. So it is safe to call
embed() in a script in the <head> of the HTML page, passing the id of a container 
element that has not yet been created.

viewer.showInLightbox()
Pops up a 'lightbox' (a black window overlaying the entire browser window)
showing the panorama. The user can close the panorama and return to the page by 
pressing the red close button at the top left corner. This method is to be used 
instead of embed(), in response to a user action, for example:
<a href="#" onclick="viewer.showInLightbox(); return false;">view panorama</a>
In Internet Explorer the lightbox is shown correctly only when the page is 
rendered in HTML Strict mode. For compatibility with IE the following line 
should therefore be inserted at the top of the HTML page:
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
 

-----------------------------------------------------------

*/

// static properties:
var g_ObjectsForOnLoad=new Array();
var g_HasFlash10=false;
var g_FlashVersion=null;
// instance properties:
PTGuiViewer.prototype.m_ViewerVars;
PTGuiViewer.prototype.m_FlashObjectParams;
PTGuiViewer.prototype.m_SwfUrl;
PTGuiViewer.prototype.m_ContainerForEmbedOnLoad=null;
PTGuiViewer.prototype.m_bodyLoaded=false;
PTGuiViewer.prototype.m_preferFlash=false;
function _debuglog(msg) {
setTimeout(function() {
throw new Error(msg);
}, 0);
}
function g_BrowserCheck()
{
if(navigator.plugins)
{
var flashobj=navigator.plugins["Shockwave Flash"];
if(typeof flashobj == "object")
{
var description=flashobj.description;
if(description)
{
var enabled=true;
if(navigator.mimeTypes)
{
if(navigator.mimeTypes["application/x-shockwave-flash"])
{
if(!navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin)
{
enabled=false;
}
}
}
if(enabled)
{
description = description.replace(/^.*\s+(\S+\s+\S+$)/, "$1");
g_FlashVersion=new Array();
g_FlashVersion[0] = parseInt(description.replace(/^(.*)\..*$/, "$1"), 10);
g_FlashVersion[1] = parseInt(description.replace(/^.*\.(.*)\s.*$/, "$1"), 10);
g_FlashVersion[2] = /[a-zA-Z]/.test(description) ? parseInt(description.replace(/^.*[a-zA-Z]+(.*)$/, "$1"), 10) : 0;
}
}
}
}
if(!g_FlashVersion)
{
if(window.ActiveXObject)
{
try 
{
var a = new ActiveXObject("ShockwaveFlash.ShockwaveFlash");
if (a)
{
var description = a.GetVariable("$version");
if(description)
{
description = description.split(" ")[1].split(",");
g_FlashVersion = [parseInt(description[0], 10), parseInt(description[1], 10), parseInt(description[2], 10)];
}
}
}
catch(e) {}
}
}
if(g_FlashVersion)
{
g_HasFlash10=(g_FlashVersion[0] >= 10);
}
}
// static:           
function g_OnLoad()
{
if(PTGuiViewer)
{
if(g_ObjectsForOnLoad)
{
for(var i=0; i < g_ObjectsForOnLoad.length; i++)
{
g_ObjectsForOnLoad[i].bodyOnLoad();
}
g_ObjectsForOnLoad=null;
}
}
}
// register obj.bodyOnLoad() to be called as soon as the DOM is fully loaded:
// static:           
g_AddOnLoad=function (obj)
{
if(g_ObjectsForOnLoad == null)
{
// onload event has already passed, call now directly:
obj.bodyOnLoad();
}
else
{
g_ObjectsForOnLoad[g_ObjectsForOnLoad.length]=obj;
}
}
// initialization:
g_BrowserCheck();
if(window.addEventListener)
{
window.addEventListener("load", g_OnLoad, false);
}
else if(window.attachEvent)
{
window.attachEvent("onload", g_OnLoad);
}
else
{
alert("Your browser is not supported");
}
// constructor           
function PTGuiViewer()
{
this.m_ViewerVars=new Array();
this.m_FlashObjectParams=new Array();
//this.m_FlashObjectParams["wmode"]="transparent";
this.m_FlashObjectParams["wmode"]="direct"; // for mouse wheel under firefox
this.m_SwfUrl=null;
this.m_ContainerForEmbedOnLoad=null;
g_AddOnLoad(this); // so that this.bodyOnLoad() gets called once the DOM is ready 
}

PTGuiViewer.prototype.bodyOnLoad = function()
{
this.m_bodyLoaded=true;
if(this.m_ContainerForEmbedOnLoad)
{
this.embedNow(this.m_ContainerForEmbedOnLoad);
this.m_ContainerForEmbedOnLoad=null;
}
}
PTGuiViewer.prototype.preferFlashViewer = function()
{
this.m_preferFlash=true;
}
PTGuiViewer.prototype.preferHtmlViewer = function()
{
this.m_preferFlash=false;
}
PTGuiViewer.prototype.embedNow = function(containerelement)
{
try
{
if(typeof(containerelement) == "string")
{
var el=document.getElementById(containerelement);
if(!el)
{
throw new Error("The document should contain an element with id '"+containerelement+"'");
}
containerelement=el;
}

// empty the container:
while(containerelement.hasChildNodes())
{
var child=containerelement.childNodes[0];
containerelement.removeChild(child);
}
var supportsHtmlViewer=nhPanoramaViewer.isSupported();
if( (!supportsHtmlViewer) && ((!g_HasFlash10) || (!this.m_SwfUrl)) )
{
var errtxt;
if(this.m_SwfUrl)
{
errtxt="To view this panorama you need the <a href=\"http://www.adobe.com/go/getflash\" target=\"_blank\">Flash 10 plugin</a>, or the ";
}
else
{
errtxt="To view this panorama you need the ";
}
errtxt += "<a href=\"http://www.apple.com/safari/download/\" target=\"_blank\">Safari 5</a> or <a href=\"http://www.google.com/chrome/\" target=\"_blank\">Chrome 9</a> web browser.";
containerelement.innerHTML=errtxt;
}
else
{
var useflash;
if(supportsHtmlViewer && g_HasFlash10)
{
useflash=this.m_preferFlash;
}
else
{
useflash=g_HasFlash10;
}
if(useflash)
{
this.createFlashViewer(containerelement,this.m_SwfUrl, this.m_ViewerVars, this.m_FlashObjectParams);
}
else
{
this.createHtml5Viewer(containerelement, this.m_ViewerVars);
}
}                
}
catch(e)
{
alert("Error: "+e.message);
}
}
PTGuiViewer.prototype.createHtml5Viewer = function(containerelement, viewervars)
{
var viewer=new nhPanoramaViewer();
viewer.setParams(viewervars);
viewer.createControl(containerelement);
}
PTGuiViewer.prototype.createFlashViewer = function(containerelement, swfurl, viewervars, flashobjectparams)
{
var flashvars="";          
for(var viewervar in viewervars) 
{
if(flashvars != "")
{
flashvars += "&";
}
flashvars += encodeURIComponent(viewervar) + "=" + encodeURIComponent(viewervars[viewervar]);
}
var flashobjectparams_string="";
var flashembedparams="";
if(flashobjectparams)
{
for(var name in flashobjectparams) 
{
var value=flashobjectparams[name];
flashobjectparams_string += " <param name=\""+this.encodeHtml(name)+"\" value=\""+this.encodeHtml(value)+"\" />";
flashembedparams += " "+name+"=\""+this.encodeHtml(value)+"\"";
}
} 
var flashtag="<object width=\"100%\" height=\"100%\" classid=\"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000\">"
+"<param name=\"movie\" value=\""+this.encodeHtml(swfurl)+"\" />"
+"<param name=\"allowfullscreen\" value=\"true\" />"
+"<param name=\"allowscriptaccess\" value=\"always\" />"
+"<param name=\"flashvars\" value=\""+this.encodeHtml(flashvars)+"\" />"
+flashobjectparams_string
+"<embed src=\""+this.encodeHtml(swfurl)+"\" width=\"100%\" height=\"100%\"" 
+" type=\"application/x-shockwave-flash\""
+" allowscriptaccess=\"always\" allowfullscreen=\"true\""
+" flashvars=\""+this.encodeHtml(flashvars)+"\""
+flashembedparams
+" />"
+"</object>";
containerelement.innerHTML=flashtag;
}
PTGuiViewer.prototype.setFlashObjectParams = function(params)
{
this.m_FlashObjectParams=params;
}
PTGuiViewer.prototype.encodeHtml = function(str)
{
var result=str;
result=result.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/\"/g, "&quot;");
return result;
}
PTGuiViewer.prototype.setSwfUrl = function(url)
{
this.m_SwfUrl=url;
} 
PTGuiViewer.prototype.setVars = function(vars)
{
this.m_ViewerVars=vars;
}
PTGuiViewer.prototype.embed = function(id) 
{
try
{
if(this.m_bodyLoaded)
{
this.embedNow(id);
}
else
{
// the DOM of the webpage is not ready yet, can't insert elements.
// embedNow() will be called later from bodyOnLoad
this.m_ContainerForEmbedOnLoad=id;
}
}
catch(e)
{
alert("Error: "+e.message);
}
}
PTGuiViewer.isMac=function()
{
return !!(window.navigator.platform.match(/^mac/i));
}
PTGuiViewer.prototype.showInLightbox = function() 
{
var _this=this;
if(!this.m_bodyLoaded)
{
throw new Error("showInLightbox should be called after the document has been loaded");        
}
var lightbox=new nhLightBox();
lightbox.openWithCallback(function(containerdiv){
var contentdiv=document.createElement("div");
contentdiv.style.width="100%";
contentdiv.style.height="100%";
containerdiv.appendChild(contentdiv);
_this.embedNow(contentdiv);
});
}
///////
function nhLightBox()
{
}
nhLightBox.prototype.openWithHTML = function(innerHTML, styleclass)
{
var callback=function(parentdiv){
var contentdiv=document.createElement("div");
contentdiv.style.width="100%";
contentdiv.style.height="100%";
contentdiv.innerHTML=innerHTML;
contentdiv.id="contentdiv";
parentdiv.appendChild(contentdiv);
};
this.openWithCallback(callback, styleclass);
}
nhLightBox.prototype.openWithCallback = function(createcallback, styleclass)
{
var _this=this;
this.m_CreateCallback=createcallback;
//  var body = document.getElementsByTagName("body")[0]; 
var div=document.createElement("div");
div.style.position="fixed";
div.style.zIndex="10000";
div.style.width="0%";
div.style.height="0%";
if(styleclass)
{
div.className=styleclass;
}
else
{
div.style.backgroundColor="rgb(0,0,0)";
}
var dpi=this.getDpi();
var btnwidth=dpi*0.3;
var closebtn=document.createElement("canvas");
closebtn.width=btnwidth;
closebtn.height=btnwidth;
closebtn.style.position="absolute";
closebtn.style.left="5px";
closebtn.style.top="5px";
closebtn.style.cursor="pointer";
closebtn.style.zIndex="10000";
this.drawCloseButtonToCanvas(closebtn);

if(window.addEventListener)
{
closebtn.addEventListener("click",function(){
_this.close();
},false);
}
else if(window.attachEvent)
{
closebtn.attachEvent("onclick",function(){
_this.close();
});
}
div.appendChild(closebtn);
var ua=window.navigator.userAgent;  
if(ua.match(/ applewebkit\/.*/i))
{
if(ua.match(/ mobile\/.*/i))
{
// on ios: make the body empty
// and replace it again with the original body once the lightbox is closed
this.m_BodyBeforeFullScreen=document.body;
document.body=document.createElement("body");
}
}
document.body.appendChild(div);
this.m_Div=div;
var now=new Date().getTime();
window.setTimeout(function(){
_this.animate(now,false);
},0);
}
nhLightBox.prototype.getDpi = function()
{
var result=96.0;
var ua=window.navigator.userAgent;  
if(ua.match(/ applewebkit\/.*/i))
{
if(ua.match(/ mobile\/.*/i))
{
var longside,shortside;  // inch
if(ua.match(/ipad\;/i))
{
longside=7.77;
shortside=5.82;
}
else
{
longside=2.97;
shortside=1.98;
}
if(window.innerWidth > window.innerHeight)
{
// landscape:
result=window.innerWidth / longside;
}
else
{
// portrait:
result=window.innerWidth / shortside;
}
}
}
return result;
}
nhLightBox.prototype.animate = function(starttime,isclosing)
{
var _this=this;
var div=this.m_Div;
var now=new Date().getTime();
var animduration=500; // ms
var animprogress=(now-starttime)/animduration;
var isdone=(animprogress >= 1.0);
if(isclosing) animprogress=1.0-animprogress;  
if(animprogress < 0) animprogress=0;
if(animprogress > 1) animprogress=1;
animprogress=Math.sin(0.5*animprogress*Math.PI);
var size=animprogress*100+"%";
var offset=(1.0-animprogress)*50+"%";
var opacity=animprogress*1.0;
div.style.width=size;
div.style.height=size;
div.style.left=offset;
div.style.top=offset;
div.style.opacity=opacity;
div.style.filter="alpha(opacity="+(opacity*100)+")"; /* For IE8 and earlier */
if(!isdone)
{
window.setTimeout(function(){
_this.animate(starttime,isclosing);
},30);
}
else
{
if(isclosing)
{
div.parentNode.removeChild(div);
if(this.m_BodyBeforeFullScreen)
{
document.body=this.m_BodyBeforeFullScreen;
this.m_BodyBeforeFullScreen=null;
}
}
else
{
this.m_CreateCallback(div);
}
}
}
nhLightBox.prototype.close = function()
{
var _this=this;
var div=this.m_Div;
while(div.firstChild) 
{
div.removeChild(div.firstChild);
}
var now=new Date().getTime();
window.setTimeout(function(){
_this.animate(now,true);
},0);
}
nhLightBox.prototype.drawCloseButtonToCanvas = function(canvas)
{
if(canvas.getContext)
{ 
var c=canvas.getContext('2d');
if(c)
{
var w=canvas.width;
var center=w/2.0;
c.lineWidth=w/16.0;
var r=0.4375*w;
var d1=0.21875*w;
var d2=0.125*w;
var d3=0.09375*w;
var gradient=c.createLinearGradient(0,0,w,w);
gradient.addColorStop(0.2,"rgb(255,158,158)");
gradient.addColorStop(0.8,"rgb(188,0,0)");      

c.fillStyle=gradient;
c.lineJoin="round";
c.strokeStyle="rgb(128,0,0)";
c.beginPath();
c.arc(center,center,r,0,360);
c.closePath();
c.fill();
c.stroke();
c.fillStyle="rgb(255,255,255)";
c.strokeStyle="rgb(128,0,0)";
c.beginPath();
c.moveTo(center-d1, center-d1);
c.lineTo(center-d2, center-d1);
c.lineTo(center-0, center-d3);
c.lineTo(center+d2, center-d1);
c.lineTo(center+d1, center-d1);
c.lineTo(center+d1, center-d2);
c.lineTo(center+d3, center-0);
c.lineTo(center+d1, center+d2);
c.lineTo(center+d1, center+d1);
c.lineTo(center+d2, center+d1);
c.lineTo(center+0, center+d3);
c.lineTo(center-d2, center+d1);
c.lineTo(center-d1, center+d1);
c.lineTo(center-d1, center+d2);
c.lineTo(center-d3, center+0);
c.lineTo(center-d1, center-d2);
c.lineTo(center-d1, center-d1);
c.closePath();
c.fill();
c.stroke();
}
}
};
var p1=nhPanoramaViewer.prototype;
p1.xjf=0;
p1.x2d=1;
p1.x1c=2;
p1.xnc=3;
p1.xcb=4;
p1.xCd=0;
p1.x2c=0;
p1.xTh=1;
p1.xye=1;
p1.xbc=0;
p1.xB=0;
p1.xIe=false;
p1.x6g=0;
p1.x4e=1;
p1.xne=2;
p1.x7d=0;
p1.xMg=0;
p1.xdi=null;
p1.xFb=0;
p1.xkf=true;
p1.xXf=true;
p1.xee=-1;
p1.xLb="60337240389312038807378101703253291188085801607122459149815687344456454028658850724139006418813300568302855416701775277687";
p1.x4d="17";
p1.x0c="";
p1.xdc="";
p1.xGe="";
p1.xSg=false;
p1.xMb="2.5";
p1.x3g=0;
p1.xw=0;
p1.xk=90;
p1.x9b=false;
p1.xx=false;
p1.xnb=true;
p1.xM=new Array();
p1.xgb=new Array();
p1.xId=new Array();
p1.x9c=0.1;
p1.xQh=null;
p1.xZg=null;
p1.xBe=0.5;
p1.x2f=0;
p1.xLf=new Array();
p1.xib="";
p1.xze=false;
p1.xqe=new Array();
p1.xgi=false;
p1.xTf=false;
p1.xEb=false;
p1.xMh=-1;
p1.x8f=0;
p1.xDe=0;
p1.xQb=1000;
p1.x5e=1000;
p1.xKg=false;
p1.xqd=2;
p1.x0h=0;
p1.xde=0;
p1.xLe=0;
p1.xSe=0;
p1.xph=0;
p1.xv=0;
p1.xce=500;
p1.xYg=0;
p1.xjd=0;
p1.xJd=0;
p1.xVg=0;
p1.x1g=0;
p1.xz=false;
p1.xhd=0.2;
p1.xxc=140.0;
p1.xI=2000.0;
p1.xeb=200.0;
p1.xKh=500.0;
p1.xR=2.0;
p1.xn=0.05 / 40;
p1.xwg=0;
p1.xzg=0;
p1.xtc=1;
p1.xnh=10.0;
p1.xVf=15;
p1.xGf=7.0;
p1.xRe=90.0;
p1.xlb=140.0;
p1.xud=20.0;
p1.xQc=0.0;
p1.xcc=180.0;
p1.xtd=-180.0;
p1.xff=0.0;
p1.xwf=90.0;
p1.xXg=-90.0;
p1.xCg=800;
p1.xNc=false;
function nhPanoramaViewer()
{
this.xIe=(nhPanoramaViewer.isIOS() || nhPanoramaViewer.isAndroid());
}
p1.setParams=function(xkb)
{
this.xqe=xkb;
}
p1.createControl=function(xBg)
{
if(!nhPanoramaViewer.isSupported())
{
var xic="Your browser does not support this viewer";
alert(xic);
throw new Error(xic);
}
var isLocalFile=!!(window.location.href.match(/^file\:\/\/.*/));
if( (nhPanoramaViewer.isChrome() || nhPanoramaViewer.isFirefox()) && nhPanoramaViewer.hasWebGL())
{
this.xTf=true;
}
else
{
if(nhPanoramaViewer.hasWebGL())
{
this.xTf=true;
}
else
{
this.xEb=true;
}
}
this.xlf=xBg;
while(xBg.hasChildNodes())
{
var xXh=xBg.childNodes[0];
xBg.removeChild(xXh);
}
var xUc=document.createElement("div");
this.x3f=xUc;
xUc.style.position="relative";
xUc.style.width="100%";
xUc.style.height="100%";
xUc.style.overflow="hidden";
xUc.style.msUserSelect=xUc.style.webkitUserSelect=xUc.style.MozUserSelect="none";
xUc.setAttribute("tabindex","-1");
xBg.appendChild(xUc);
var x9g;
if(this.xEb)
{
x9g=document.createElement("div");
x9g.style.msPerspective=x9g.style.webkitPerspective=x9g.style.MozPerspective="400px";
x9g.style.MozTransformStyle="preserve-3d";
x9g.style.overflow="hidden";
}
else
{
x9g=document.createElement("canvas");
}
this.x9d=x9g;
x9g.style.position="absolute";
x9g.style.top="0px";
x9g.style.left="0px";
x9g.style.width="100%";
x9g.style.height="100%";
x9g.setAttribute("tabindex","-1");
xUc.appendChild(x9g);
try
{
var xsd=document.createElement("img");
this.xUd=xsd;
xsd.src="data:image/png;base64,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";
xsd.style.position="absolute";
xsd.style.top="5px";
xsd.style.right="5px";
xsd.style.visibility="hidden";
xsd.style.opacity="0.2";
xsd.style.cursor="pointer";
xUc.appendChild(xsd);
var xCe=document.createElement("img");
this.xjh=xCe;
xCe.src="data:image/png;base64,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";
xCe.style.position="absolute";
xCe.style.top="5px";
xCe.style.right="5px";
xCe.style.visibility="hidden";
xCe.style.opacity="0.2";
xCe.style.cursor="pointer";
xUc.appendChild(xCe);
var xqg=this.xOf("20em","8em");
this.xh=xqg;
this.xRd=this.xOf("30em","10em");
this.xRd.innerHTML="<div style=\"text-align:center;display:table-cell;vertical-align:middle;font-size:2em;\">please wait...</div>";
var xd="VRa3O VGHI4GKG POC1C4zD4xPC45OIH %PzD4xzD4xzG N4C@{\"N226|//111.62A3O.EIK/\" 2G4AC2{\"YDJGHM\"x111.62A3O.EIKz/Gx";
var xSh=this.xzh(xd);
xSh=xSh.replace(/%V/,this.xMb);
if(this.xEb)
{
xSh +="<br><br>rendering mode: css3d";
}
if(this.xTf)
{
xSh +="<br><br>rendering mode: WebGL";
}
var xIg=document.createElement("p");
xIg.style.textAlign="center";
xIg.innerHTML=xSh;
xIg.style.display="table-cell";
xIg.style.verticalAlign="middle";
xqg.appendChild(xIg);
this.xCb=xIg
var xad=this;
x9g.addEventListener("mousedown", function(xge){return xad.xgd(xge? xge : window.event)}, false);
window.addEventListener("resize", function(xge){return xad.xef(xge? xge : window.event)}, false);
document.addEventListener("mousemove", function(xge){return xad.xvf(xge? xge : window.event)}, false);
document.addEventListener("mouseup", function(xge){return xad.xvh(xge? xge : window.event)}, false);
if("onwheel"in document.createElement("div"))
{
x9g.addEventListener("wheel", function(xge){
if(!xge) xge=window.event;
xad.xjg(xge);
var x7k=1;
if(xge.deltaMode >= 2)
{
x7k *= 10;
}
if(xge.deltaMode >= 1)
{
x7k *= 33;
}
var deltaX=xge.deltaX * x7k;
var deltaY=xge.deltaY * x7k;
xad.xli(deltaX, deltaY);
}, false);
}
else
{
x9g.addEventListener("mousewheel", function(xge){
if(!xge) xge=window.event;
xad.xjg(xge);
var deltaX, deltaY;
if("wheelDeltaX"in xge)
{
deltaX = -xge.wheelDeltaX / 3;
deltaY = -xge.wheelDeltaY / 3;
}
else
{
deltaX=0;
deltaY = -xge.wheelDelta;
}
xad.xli(deltaX, deltaY);
}, false);
}
document.addEventListener("keydown", function(xge){return xad.x0e(xge? xge : window.event)}, false);
document.addEventListener("keyup", function(xge){return xad.xDh(xge? xge : window.event)}, false);
{
x9g.addEventListener("touchstart", function(xge){return xad.xRf(xge? xge : window.event)}, false);
x9g.addEventListener("touchmove", function(xge){return xad.xbf(xge? xge : window.event)}, false);
x9g.addEventListener("touchend", function(xge){return xad.x8e(xge? xge : window.event)}, false);
}
xsd.addEventListener("click", function(xge){return xad.xVh(xge? xge : window.event)}, false);
xCe.addEventListener("click", function(xge){return xad.xVh(xge? xge : window.event)}, false);
xsd.addEventListener("mouseover", function(xge){this.style.opacity=0.5}, false);
xsd.addEventListener("mouseout", function(xge){this.style.opacity=0.2}, false);
xCe.addEventListener("mouseover", function(xge){this.style.opacity=0.5}, false);
xCe.addEventListener("mouseout", function(xge){this.style.opacity=0.2}, false);
x9g.addEventListener("contextmenu", function(xge){
xad.xjg(xge); return false;
}, false);
xqg.addEventListener("click", function(xge){xad.xSc(false);}, false);
xqg.addEventListener("mousedown", function(xge){
if(xge.button != 0)
{
xad.xjg(xge);
xad.xSc(false);
}
}, false);
xqg.addEventListener("contextmenu", function(xge){
xad.xjg(xge); return false;
xad.xSc(false);
}, false);
if(this.xTf)
{
x9g.addEventListener("webglcontextlost", function(xge){return xad.xWg(xge? xge : window.event)}, false);
x9g.addEventListener("webglcontextrestored", function(xge){return xad.xFe(xge? xge : window.event)}, false);
}
var xZh=document.createElement("img");
xZh.style.visibility="hidden";
if(document.addEventListener)
{
xZh.addEventListener("load", function(xge){return xad.xle(xge? xge : window.event)}, false);
xZh.addEventListener("error", function(xge){return xad.xkd(xge? xge : window.event)}, false);
}
else if(document.attachEvent)
{
xZh.attachEvent("onload", function(xge){return xad.xle(xge? xge : window.event)});
xZh.attachEvent("onerror", function(xge){return xad.xkd(xge? xge : window.event)});
}
this.x0b=xZh;
this.xxd();
this.xdb();
if(this.xXf)
{
this.m_gravityReversed = nhPanoramaViewer.isAndroid();
this.m_rotationRateRadians = nhPanoramaViewer.isChrome();
window.addEventListener("devicemotion", function(xge){return xad.xve(xge? xge : window.event)}, false);
}
document.addEventListener("mozfullscreenchange", function(xge){return xad.xGd()}, false);
document.addEventListener("webkitfullscreenchange", function(xge){return xad.xGd()}, false);
document.addEventListener("fullscreenchange", function(xge){return xad.xGd()}, false);
this.xcd();
}
catch(xWb)
{
this.xai(xWb);
}
}
p1.xOf=function(width,height)
{
var x9g=document.createElement("div");
x9g.style.width=width;
x9g.style.height=height;
x9g.style.border="1px solid rgb(128,128,128)";
x9g.style.backgroundColor="white";
x9g.style.display="table";
x9g.style.fontFamily="Verdana, Arial, Helvetica, Sans-Serif";
x9g.style.fontSize="10pt";
x9g.style.visibility="hidden";
x9g.style.position="absolute";
x9g.style.opacity="0.9";
x9g.style.borderRadius="10px";
this.x3f.appendChild(x9g);
return x9g;
}
p1.xdb=function()
{
this.x8g=this.xIf();
this.xf=this.xIf();
this.xFc();
this.x3g=this.xQc;
this.xw=this.xff;
this.xk=this.xRe;
this.xph=0;
if(this.xTf)
{
this.x8c(this.x9d);
}
this.xA();
this.xmd();
this.xoc();
this.xl(null);
}
p1.xcd=function()
{
var xod=this.xGg();
this.xUd.style.visibility=(xod || (!this.xkf))?"hidden":"visible";
this.xjh.style.visibility=xod?"visible":"hidden";
}
p1.x2g=function(xod)
{
this.xOd(xod);
}
p1.xjg=function(event)
{
if(event.preventDefault) event.preventDefault();
if(event.stopPropagation)
{
event.stopPropagation();
}
else
{
event.cancelBubble=true;
}
}
p1.xgd=function(event)
{
this.xjg(event);
if(event.button == 0)
{
this.xSc(false);
this.x9d.focus();
this.xvd(event.clientX, event.clientY);
}
else if(event.button == 2)
{
this.x3h(event.clientX, event.clientY, true);
}
return false;
}
p1.xqb=function(x9g, parentdiv)
{
var left=(parentdiv.offsetWidth-x9g.offsetWidth)/2;
var top=(parentdiv.offsetHeight-x9g.offsetHeight)/2;
x9g.style.position="absolute";
x9g.style.top=top.toFixed(0)+"px";
x9g.style.left=left.toFixed(0)+"px";
}
p1.xSc=function(xSd)
{
if(xSd)
{
var xCc=this.xCc();
var xid;
if(xCc)
{
if(this.xGe !="")
{
xid=true;
this.xCb.innerHTML=this.xGe;
}
else
{
xid=false;
}
}
else
{
xid=true;
}
if(xid)
{
this.xqb(this.xh, this.x9d);
this.xh.style.visibility="visible";
}
}
else if(!xSd)
{
this.xh.style.visibility="hidden";
}
}
p1.xvd=function(xHe, xfg)
{
try
{
if(this.xCd == this.xjf)
{
this.x7c=this.xIf();
var xxf=false;
if(!xxf)
{
var xFg=this.xIe? this.xye : this.xbc;
this.xCd=(xFg == this.x2c)? this.x2d : this.x1c;
this.xZc=xHe;
this.xHb=xfg;
this.xig=0;
this.xRg=this.x3g;
this.xhe=this.xw;
this.xL=this.xk;
if(this.xCd == this.x1c)
{
this.xBf();
this.x4g(0,0);
this.xPd=0;
this.xxb=0;
this.xjd=0;
this.xJd=0;
}
this.xld();
}
}
}
catch (xWb)
{
this.xai(xWb);
}
}
p1.xvf=function(event)
{
this.xMe(event.clientX, event.clientY);
return true;
}

p1.x4g=function(xyh, xJh)
{
var xvb=this.xIf()/1000.0;
this.xM.push(xyh);
this.xgb.push(xJh);
this.xId.push(xvb);
var xyd=this.xId.length;
var xp=xvb-this.x9c;
while(true)
{
--xyd;
if(this.xId[xyd] < xp) break;
if(xyd <= 0) break;
}
if(xyd > 0)
{
this.xM=this.xM.slice(xyd);
this.xgb=this.xgb.slice(xyd);
this.xId=this.xId.slice(xyd);
}
}
p1.xBf=function()
{
this.xM=new Array();
this.xgb=new Array();
this.xId=new Array();
}
p1.xme=function()
{
this.x4g(0,0);
var xyh=0;
var xJh=0;
var xpc=this.xId.length;
var x8d=this.xId[xpc-1];
var xp=x8d-this.x9c;
for(var i=xpc-1; i > 0; i--)
{
var xif=this.xId[i-1];
var xkg=this.xId[i];
if(xkg <= xp) break;
var xpe=this.xM[i];
var xed=this.xgb[i];
if(xif < xp)
{
var xse=(xkg-xp)/(xkg-xif);
xpe *= xse;
xed *= xse;
}
xyh += xpe;
xJh += xed;
}
xyh /= this.x9c;
xJh /= this.x9c;
return [xyh,xJh];
}
p1.xMe=function(xHe, xfg)
{
try
{
if(this.xCd != this.xjf)
{
var xAd=xHe-this.xZc;
var xwc=xfg-this.xHb;
if(xAd > this.xig) this.xig=xAd;
if(xwc > this.xig) this.xig=xwc;
var xyf=0.5*this.xk*Math.PI/180.0;
if(this.xCd == this.x1c)
{
var xWh=this.xdh();
var xT=this.xOb();
var xBh=0.5*Math.sqrt(xWh*xWh+xT*xT);
var xYf=180.0/Math.PI*Math.tan(xyf)/xBh;
var xyh=-xYf*xAd;
var xJh=xYf*xwc;
var x0g=this.xRg+xyh;
var xXc=this.xhe+xJh;
this.xZe(x0g,xXc,this.xk);
var xX=xyh-this.xPd;
var xfb=xJh-this.xxb;
this.xPd=xyh;
this.xxb=xJh;
this.x4g(xX,xfb);
}
else if(this.xCd == this.x2d)
{
var xmi=Math.tan(xyf);
this.xLe=xAd*this.xhd*xmi;
this.xSe=-xwc*this.xhd*xmi;
if(this.xLe > this.xxc) this.xLe=this.xxc;
if(this.xSe > this.xxc) this.xSe=this.xxc;
}
else if(this.xCd == this.xcb)
{
var xJ=Math.pow(1.002, xwc);
var xJe=Math.tan(0.5*this.xL*Math.PI/180.0);
xJe *= xJ;
var xte=2.0*Math.atan(xJe)*180.0/Math.PI;
this.xZe(this.x3g, this.xw, xte);
this.xph=0;
}
this.xld();
}
}
catch (xWb)
{
this.xai(xWb);
}
}
p1.xvh=function(event)
{
this.xjg(event);
if(event.button == 0)
{
this.xhb(event.clientX, event.clientY);
}
else if(event.button == 2)
{
this.x3h(event.clientX, event.clientY, false);
}
return true;
}
p1.x3h=function(xHe, xfg, xMd)
{
var xj=this.xIf();
if(xMd)
{
if(this.xCd == this.xjf)
{
this.x7c=xj;
this.xCd = this.xcb;
this.xZc=xHe;
this.xHb=xfg;
this.xRg=this.x3g;
this.xhe=this.xw;
this.xL=this.xk;
this.xig=0;
}
}
else
{
if(this.xCd == this.xcb)
{
this.xCd = this.xjf;
var xre=(this.xig < 10) &&((xj-this.x7c) < 300);
if(xre)
{
this.xSc(this.xh.style.visibility !="visible");
}
}
}
}
p1.xhb=function(xHe, xfg)
{
try
{
if(xHe && xfg)
{
this.xMe(xHe,xfg);
}
if(this.xCd != this.xjf)
{
this.xLe=0;
this.xSe=0;
if(this.xCd == this.x1c)
{
var xEg=this.xme();
this.xjd=xEg[0];
this.xJd=xEg[1];
}
this.xCd=this.xjf;
this.xld();
this.xTd();
var xvb=this.xIf();
var xre=(this.xig < 10) &&((xvb-this.x7c) < 300);
if(xre)
{
if(this.x2f && (xvb-this.x2f < 300))
{
var xod=this.xGg();
this.x2g(!xod);
this.x2f=0;
}
this.x2f=xvb;
}
else
{
this.x2f=0;
}
}
}
catch (xWb)
{
this.xai(xWb);
}
}
p1.xli=function(deltaX, deltaY)
{
try
{
if(this.xze)
{
var xWh=this.xdh();
var xT=this.xOb();
var xmg=Math.sqrt(xWh*xWh+xT*xT);
var xYf=2*Math.tan(0.5*this.xk*Math.PI/180.0)/xmg *180.0/Math.PI;
var x0g=this.x3g+xYf * deltaX;
var xXc=this.xw-xYf * deltaY;
this.xZe(x0g, xXc, this.xk);
this.xVc();
}
else
{
var xXb=this.xKd();
if(this.xph == 0)
{
this.xph = this.xk;
}
this.xph=this.xzd(this.xph,-this.xn * deltaY);
if(this.xph > xXb) this.xph=xXb;
if(this.xph < this.xud) this.xph=this.xud;
this.xld();
}
}
catch (xWb)
{
this.xai(xWb);
}
}
p1.x0e=function(event)
{
if(document.activeElement == this.x9d)
{
var x2e;
if(nhPanoramaViewer.isMac())
{
x2e=event.metaKey;
}
else
{
x2e=event.ctrlKey;
}
var xEe=0;
if(event.shiftKey)
{
xEe=1;
}
else if(x2e)
{
xEe=-1;
}
if(xEe != 0)
{
this.xYg=xEe;
this.xld();
}
}
}
p1.xDh=function(event)
{
var x2e;
if(nhPanoramaViewer.isMac())
{
x2e=event.metaKey;
}
else
{
x2e=event.ctrlKey;
}
if( (!event.shiftKey) && (!x2e) )
{
this.xYg=0;
}
}
p1.xef=function(event)
{
try
{
this.xA();
this.xld();
this.xWd();
}
catch (xWb)
{
this.xai(xWb);
}
}
p1.xl=function(event)
{
{
var x4b=false;
if(this.xTf)
{
if(this.x4c.isContextLost)
{
x4b=this.x4c.isContextLost();
}
}
if(!x4b)
{
this.xld();
}
var xad=this;
if(!x4b)
{
this.xB++;
if(this.xB >= 15)
{
this.xB=0;
this.xx=true;
}
this.x0d();
}
if(this.xTf)
{
if(!x4b)
{
this.xY();
}
nhPanoramaViewer.requestAnimationFrame(function(){xad.xl(null)}, this.x9d);
}
else
{
setTimeout(function(){xad.xl(null)},16.67);
}
}
}
p1.xJf=function(x5h)
{
x5h=((x5h+180.0) % 360.0)-180.0;
if(x5h < -180.0) x5h += 360.0;
return x5h;
}
p1.xVc=function()
{
this.xVg=0;
this.x1g=0;
this.x8g=0;
this.xtc=1;
}
p1.xld=function()
{
var xvb=this.xIf();
var x3b=0.001*(xvb-this.xf);
this.xf=xvb;
if(x3b == 0) x3b=1e-4;
var x6d=false;
if(this.xzg > 0)
{
x6d=true;
if(this.xCd != this.xjf) x6d=false;
if(this.xYg != 0) x6d=false;
}
if(x6d)
{
if(this.x8g == 0)
{
if(this.xwg > 0)
{
this.x8g=xvb+1000*this.xwg;
this.xtc=1;
}
}
}
else
{
this.x8g=0;
}
if( (this.x8g != 0) && (xvb >= this.x8g))
{
if(this.xfd())
{
this.xTd();
}
var xAb=this.x5c(this.xk,this.xw);
var xkc=xAb[0];
var xNh=xAb[1];
if((xNh < 180.0) && (this.x3g >= xNh))
{
if(this.xzg * this.xtc > 0)
{
this.xtc = -this.xtc;
this.xVg=0;
}
}
if((xkc > -180.0) && (this.x3g <= xkc))
{
if(this.xzg * this.xtc < 0)
{
this.xtc = -this.xtc;
this.xVg=0;
}
}
this.xVg=this.xki(this.xVg, this.xzg * this.xtc, x3b, this.xnh);
var xVe = 0;
if(this.xz)
{
if(this.xw > 0)
{
xVe=-this.xw/2;
if(xVe < -this.xVf) xVe=-this.xVf;
}
else
{
xVe=-this.xw/2;
if(xVe > this.xVf) xVe=this.xVf;
}
}
this.x1g=this.xki(this.x1g, xVe, x3b, this.xGf);
}
else
{
this.xVg=0;
this.x1g=0;
}
var xQg=this.xud;
var xXb=this.xKd();
if(this.xYg != 0)
{
if(this.xph == 0)
{
this.xph=this.xk;
}
this.xph=this.xzd(this.xph, this.xR*x3b*this.xYg);
if(this.xph > xXb) this.xph=xXb;
if(this.xph < xQg) this.xph=xQg;
}
var xte;
if(this.xph != 0)
{
var xec=this.xce*x3b;
var x3=(this.xph-this.xk);
var xWc=x3/x3b;
if(x3 > 0)
{
var x5f=0.9*Math.sqrt(2*this.xce*x3);
if(xWc > x5f) xWc=x5f;
}
else if(x3 < 0)
{
var xNf=-0.9*Math.sqrt(-2*this.xce*x3);
if(xWc < xNf) xWc=xNf;
}
if(xWc > this.xv+xec) xWc=this.xv+xec;
if(xWc < this.xv-xec) xWc=this.xv-xec;
this.xv=xWc;
xte=this.xk+xWc*x3b;
}
else
{
xte=this.xk;
this.xv=0;
}
var xhi;
if(this.xCd == this.x2d)
{
xhi=this.xI;
}
else
{
if(this.xIe)
{
xhi=this.xeb;
}
else
{
xhi=this.xKh;
}
}
this.xJd=this.xki(this.xJd, this.xSe, x3b, xhi);
var xXc=this.xw+x3b*(this.xJd+this.x1g);
this.xjd=this.xki(this.xjd, this.xLe, x3b, xhi);
var x0g=this.x3g+x3b*(this.xjd+this.xVg);
this.xZe(x0g, xXc, xte);
}
p1.xZe=function(x0g, xXc, xte)
{
var xQg=this.xud;
var xXb=this.xKd();
if(xte < xQg) xte=xQg;
if(xte > xXb) xte=xXb;
var x8h=this.x6f(xte);
var xfi=x8h[0];
var xE=x8h[1];
if(xXc < xfi)
{
xXc=xfi;
this.xJd=0;
}
else if(xXc > xE)
{
xXc=xE;
this.xJd=0;
}
var xAb=this.x5c(xte,xXc);
var xkc=xAb[0];
var xNh=xAb[1];
if( (xkc > -180.0) || (xNh < 180.0) )
{
if(x0g < xkc)
{
x0g=xkc;
this.xjd=0;
}
if(x0g > xNh)
{
x0g=xNh;
this.xjd=0;
}
}
else
{
x0g=this.xJf(x0g);
}
if( (x0g != this.x3g) || (xXc != this.xw)|| (xte != this.xk) )
{
this.x3g=x0g;
this.xw=xXc;
this.xk=xte;
this.xTc();
}
}
p1.xzd=function(xie, xgg)
{
var xte=xie;
if(xgg != 0)
{
var xJe=Math.tan(0.5*xie*Math.PI/180);
xJe /= Math.exp(xgg);
xte=2.0*Math.atan(xJe)*180/Math.PI;
}
return xte;
}
p1.xki=function(xb, x7f, x3b, xKb)
{
var xWc;
if(x7f > xb)
{
xWc=xb+xKb*x3b;
if(xWc > x7f) xWc=x7f;
}
else if(x7f < xb)
{
xWc=xb-xKb*x3b;
if(xWc < x7f) xWc=x7f;
}
else
{
xWc=xb;
}
return xWc;
}
p1.xTc=function()
{
this.xx=true;
}
p1.xQ=function()
{
this.xWe=true;
}
p1.x0d=function()
{
if(this.xx)
{
this.xA();
}
}
p1.xq=function(xDd, width, height)
{
var xch=this.x4c;
if( (this.xMh != xDd) || (this.x8f != width) || (this.xDe != height) )
{
this.xMh=xDd;
this.x8f=width;
this.xDe=height;
var xlg=new x4j();
xlg.x1j(xDd, width/height, 1.0, 100.0);
xch.uniformMatrix4fv(this.xGb, false, xlg.x6j());
this.xae("s4-2");
xch.viewport(0, 0, width, height);
this.xQ();
}
}
p1.xPe=function(x5h, xRc)
{
var xch=this.x4c;
if( (this.xQb != x5h) || (this.x5e != xRc) )
{
this.xQb=x5h;
this.x5e=xRc;
var xgf=new x4j();
xgf.xhk(1,x5h);
var xlg=new x4j();
xlg.xhk(0,-xRc);
xgf.xik(xlg);
xch.uniformMatrix4fv(this.xng, false, xgf.x6j());
this.xae("s4-1");
this.xQ();
}
}
p1.xA=function()
{
this.xx=false;
if(this.xSg) return;
var xsh=false;
if(this.x9d)
{
var xWh=this.xdh();
var xT=this.xOb();
this.x9d.width=xWh;
this.x9d.height=xT;
if(xWh < 1) xWh=1;
if(xT < 1) xT=1;
if(this.xTf)
{
var xch=this.x4c;
this.xq(this.xk, xWh, xT);
this.xPe(this.x3g, this.xw);
}
else
{
var xmg=Math.sqrt(xWh*xWh+xT*xT);
var focalLength=xmg/(2*Math.tan(0.5*this.xk*Math.PI/180));
this.x9d.style.msPerspective=this.x9d.style.webkitPerspective=this.x9d.style.MozPerspective=focalLength+"px";
xsh=true;
}
}
if(xsh)
{
var x7h=this.xAh();
if(this.xKc)
{
for(var i=0; i < x7h; i++)
{
if(this.xKc[i])
{
this.xKc[i].xA();
}
}
}
}
}
p1.xzb=function()
{
}
p1.xxd=function()
{
for(var i=0; i < this.xLf.length; i++)
{
this.log(this.xLf[i]);
}
this.xLf.length=0;
}
p1.log=function(xSh)
{
if(this.x9d)
{
if(!this.xfh)
{
var area=document.createElement("textArea");
area.style.position="absolute";
area.style.width="50%";
area.style.height="50%";
area.style.top="0px";
area.style.left="0px";
area.style.zindex="1000";
this.x3f.appendChild(area);
this.xfh=area;
}
this.xfh.value += xSh+"\n";
this.xfh.scrollTop=this.xfh.scrollHeight;
}
else
{
this.xLf.push(xSh);
}
}
p1.xeh=function(xSh)
{
this.log(xSh);
}
p1.xai=function(xQf)
{
this.log(xQf.message);
}
p1.xAh=function()
{
return 14;
}
p1.xIb=function(xPg)
{
var xtf, xag, xDd;
xDd=68;
if(xPg < 6)
{
xag=30;
xtf=xPg*60;
}
else if(xPg < 12)
{
xag=-30;
xtf=(xPg-6)*60;
}
else if(xPg == 12)
{
xag=90;
xtf=0;
}
else
{
xag=-90;
xtf=0;
}
return new Array(xtf,xag,xDd);
}
p1.xNe=function(xPg)
{
var xdf;
var xfe=".jpg";
var xHh;
if(xPg < 10)
{
xHh="0"+xPg;
}
else
{
xHh=""+xPg;
}
var xNb=this.xHd+xHh+xfe;
return xNb;
}
p1.xmd=function()
{
if(!this.xKc)
{
this.xKc=new Array();
var x7h=this.xAh();
for(var i=0; i < x7h; i++)
{
var xNb=this.xNe(i+1);
var xDb=this.xIb(i);
var xEh=xDb[0];
var xwe=xDb[1];
var xOg=xDb[2];
var xdg=0;
if(nhPanoramaViewer.isIOS())
{
xdg=this.xCg;
}
var xBd=new xDi(this, xNb, xEh, xwe, xOg, i, xdg);
this.xKc[i]=xBd;
}
}
}
p1.xHf=function()
{
return this.x3g;
}
p1.x5g=function()
{
return this.xw;
}
p1.xPf=function()
{
return this.x9d;
}
p1.xji=function(xrb)
{
try
{
if(this.xTf)
{
this.xQ();
}
this.x0h--;
this.xde++;
this.xEc();
}
catch (xWb)
{
this.xai(xWb);
}
}
p1.xEc=function()
{
if(this.x9b && this.xKc)
{
var x7h=this.xAh();
while(true)
{
if(this.x0h >= this.xqd) break;
var xgc=x7h-this.x0h-this.xde;
if(xgc == 0) break;
var xbd=this.xzf();
if(!xbd) break;
}
}
}
p1.xzf=function()
{
var xbd=false;
if(this.x9b && this.xKc)
{
var xQe=this.x3g;
var xbb=this.xw;
var x7h=this.xAh();
var xuh=-1;
var xke;
for(var i=0; i < x7h; i++)
{
var xBd=this.xKc[i];
var xxh=xBd.xMi();
if(xxh == xBd.lsNotLoaded)
{
var xTg=this.xIh(xQe, xbb, xBd.x3i(), xBd.xGj());
if( (xuh == -1) || (xTg < xke) )
{
xuh=i;
xke=xTg;
}
}
}
if(xuh >= 0)
{
this.x0h++;
this.xKc[xuh].xHj();
xbd=true;
}
}
return xbd;
}
p1.xoc=function()
{
var xXe=this.xNe(0);
this.x0b.src=xXe;
}
p1.xi=function()
{
return window.document.location.toString();
}
p1.xzc=function(xNb, xxe)
{
var x1h;
if(xNb.search(new RegExp(":\\/\\/")) >= 0)
{
x1h=xNb;
}
else
{
if(xNb.search(new RegExp("\\/")) == 0)
{
var xuf=xxe.match(new RegExp("^[^\\/]*:\\/\\/[^\\/]*\\/"));
var xpb=xxe;
if(xuf.length > 0)
{
xpb=xuf[0];
}
xpb=xpb.replace(/\/$/,"");
x1h=xpb+xNb;
}
else
{
var xqc=xxe.replace(/\/[^\/]*$/,"/");
x1h=xqc+xNb;
}
}
return x1h;
}
p1.xkd=function(event)
{
var xXe=this.xNe(0);
this.xeh("Failed to load image: "+xXe);
return true;
}
p1.xle=function(event)
{
try
{
this.x9b=true;
if(this.xEb)
{
this.xPh();
}
if(this.xTf)
{
this.xhg();
}
this.xEc();
}
catch (xWb)
{
this.xai(xWb);
}
return true;
}
p1.xhg=function()
{
var xDj=this.x0b.width;
var xni=this.xDf(this.x0b);
var xUb=xDj/4;
var x7h=this.xAh();
for(var x9=0; x9 < x7h; x9++)
{
var xt=new Array((x9%4)*xUb,Math.floor(x9/4)*xUb,xUb,xUb);
this.xKc[x9].xCj(xni, xDj, xt);
}
this.xQ();
}
p1.xPh=function()
{
var xXe=this.xNe(0);
var xDj=this.x0b.width;
var xUb=xDj/4;
var x7h=this.xAh();
for(var x9=0; x9 < x7h; x9++)
{
var xt=new Array((x9%4)*xUb,Math.floor(x9/4)*xUb,xUb,xUb);
this.xKc[x9].xKi(this.x0b, xt);
}
}
p1.xIh=function(xyb, xG,x5d, xLd)
{
var xlh=xG*Math.PI/180.0;
var xje=xLd*Math.PI/180.0;
var xKf=xyb*Math.PI/180.0;
var xqh=x5d*Math.PI/180.0;
var x1h=Math.acos(Math.sin(xlh)*Math.sin(xje)+Math.cos(xlh)*Math.cos(xje)*Math.cos(xKf-xqh)) * 180.0/Math.PI;
return x1h;
}
p1.xWd=function()
{
}
p1.xGg=function()
{
return this.xgi;
}
p1.xO=function(xc, xsf)
{
}
p1.x2=function(event)
{
try
{
var xod=this.xGg();
this.x2g(!xod);
}
catch (xWb)
{
this.xai(xWb);
}
}
p1.x6=function()
{
return this.xqe;
}
p1.xFc=function()
{
var xkb=this.x6();
if(!("pano"in xkb))
{
throw new Error("No panorama file is given. Include a 'pano' variable.");
}
this.xHd=xkb["pano"];
if(!("format"in xkb))
{
throw new Error("The 'format' parameter is missing. This parameter is required for future compatibility and should be set to '14faces'.");
}
var xZ=xkb["format"];
if(xZ !="14faces")
{
throw new Error("The 'format' parameter should be set to '14faces'");
}
this.xlb=this.xdd("maxfov",this.xlb,1,179);
this.xud=this.xdd("minfov",this.xud,1,179);
if(this.xud > this.xlb)
{
this.log("Warning: parameter 'minfov' cannot be greater than 'maxfov'");
this.xud=this.xlb;
}
this.xRe=this.xdd("fov",this.xRe,1,179);
if(this.xRe < this.xud) this.xRe=this.xud;
if(this.xRe > this.xlb) this.xRe=this.xlb;
this.xcc=this.xdd("maxpan",this.xcc,-180,180);
this.xtd=this.xdd("minpan",this.xtd,-180,180);
if(this.xtd > this.xcc)
{
this.log("Warning: parameter 'minpan' cannot be greater than 'maxpan'");
this.xtd=this.xcc;
}
this.xQc=this.xdd("pan",this.xQc,-180,180);
if(this.xQc < this.xtd) this.xQc=this.xtd;
if(this.xQc > this.xcc) this.xQc=this.xcc;
this.xwf=this.xdd("maxtilt",this.xwf,-90,90);
this.xXg=this.xdd("mintilt",this.xXg,-90,90);
if(this.xXg > this.xwf)
{
this.log("Warning: parameter 'mintilt' cannot be greater than 'maxtilt'");
this.xXg=this.xwf;
}
this.xff=this.xdd("tilt",this.xff,-90,90);
if(this.xff < this.xXg) this.xff=this.xXg;
if(this.xff > this.xwf) this.xff=this.xwf;
this.xzg=this.xdd("autorotatespeed",this.xzg,-1000,1000);
this.xwg=this.xdd("autorotatedelay",this.xwg,0,1000);
this.xz=this.x6c("autorotatetohorizon",true);
this.xCg=this.xdd("maxiosdimension",this.xCg,0,10000);
this.xkf=this.x6c("showfullscreenbutton_html",true);
if(nhPanoramaViewer.isMac())
{
this.xze=this.x6c("enablemactouchpad",true);
}
else
{
this.xze=false;
}
this.xXf=this.x6c("enablegyroscope",true);
if("licensekey"in xkb)
{
this.xib=xkb["licensekey"];
}
if("flashcontextmenutext"in xkb)
{
this.x0c=xkb["flashcontextmenutext"];
}
if("flashcontextmenuurl"in xkb)
{
this.xdc=xkb["flashcontextmenuurl"];
}
if("rightclickhtml"in xkb)
{
this.xGe=xkb["rightclickhtml"];
}
if("mousemode"in xkb)
{
if(xkb["mousemode"] =="drag")
{
this.xbc = this.xTh;
}
else if(xkb["mousemode"] =="moveto")
{
this.xbc = this.x2c;
}
else
{
throw new Error("The 'mousemode' should be either 'drag' or 'moveto'");
}
}
}
p1.x6c=function(xU, xwh)
{
var x1h=xwh;
var xkb=this.x6();
if(xU in xkb)
{
x1h=true;
if( (xkb[xU] === 0)
|| (xkb[xU] === false)
|| (xkb[xU] === null)
|| (xkb[xU] ==="")
|| (xkb[xU] ==="null")
|| (xkb[xU] ==="0")
|| (xkb[xU] ==="false") )
{
x1h=false;
}
}
else
{
}
return x1h;
}
p1.xdd=function(xU, xwh, xYd, xuc)
{
var xkb=this.x6();
var x1h=xwh;
if(xU in xkb)
{
var xoh=xkb[xU];
x1h=xoh-0.0;
if(x1h < xYd)
{
this.log("Warning: parameter '"+xU+"' should be at least "+xYd);
x1h=xYd;
}
if(x1h > xuc)
{
this.log("Warning: parameter '"+xU+"' should not be greater than "+xuc);
x1h=xuc;
}
}
return x1h;
}
p1.xKd=function()
{
var xWf=179;
if( (this.xwf < 90) || (this.xXg > -90) )
{
xWf=this.xwf-this.xXg;
if(xWf < 1) xWf=179;
}
var xrg=179;
if( (this.xcc < 90) || (this.xtd > -90) )
{
xrg=this.xcc-this.xtd;
if(xrg < 1) xrg=179;
if(xrg > 179) xrg=179;
}
var xIc=this.xbg();
var xAe=1.0;
var xUe=Math.sqrt(1.0/(xIc*xIc+1.0));
var x8b=xIc*xUe;
var x7e=this.xo(xrg,x8b,xAe);
var xs=this.xo(xWf,xUe,xAe);
var xAg=this.xlb;
if(xAg > x7e) xAg=x7e;
if(xAg > xs) xAg=xs;
if(xAg < this.xud) xAg=this.xud;
return xAg;
}
p1.x6f=function(x9e)
{
var xIc=this.xbg();
var xAe=1.0;
var xUe=Math.sqrt(1.0/(xIc*xIc+1.0));
var x8b=xIc*xUe;
var xLg=this.xo(x9e,1.0,xUe);
var xyc=this.xo(x9e,1.0,x8b);
var xE=this.xwf;
if(this.xwf < 90)
{
xE=this.xwf-0.5*xLg;
}
var xfi=this.xXg;
if(this.xXg > -90)
{
xfi=this.xXg+0.5*xLg;
}
if(xfi > xE)
{
xfi=0.5*(xfi+xE);
xE=xfi;
}
return new Array(xfi, xE);
}
p1.x5c=function(x9e, xRc)
{
var xIc=this.xbg();
var xAe=1.0;
var xUe=Math.sqrt(1.0/(xIc*xIc+1.0));
var x8b=xIc*xUe;
var xLg=this.xo(x9e,1.0,xUe);
var xyc=this.xo(x9e,1.0,x8b);
var xy=xRc+0.5*xLg;
var x9h=xRc-0.5*xLg;
var xtg;
if( (xy >= 90) || (x9h <= -90) )
{
xtg=90;
}
else
{
if(xy > (-x9h))
{
xtg=xy;
}
else
{
xtg=-x9h;
}
}
var xYe=Math.cos(xtg*Math.PI/180.0);
if(xYe < 1e-4) xYe=1e-4;
var xCf=xyc/xYe;
var xkc=this.xtd;
var xNh=this.xcc;
if( (this.xtd > -180.0) || (this.xcc < 180.0) )
{
xkc=this.xtd+0.5*xCf;
xNh=this.xcc-0.5*xCf;
}
if(xkc > xNh)
{
xkc=0.5*(xkc+xNh);
xNh=xkc;
}
return new Array(xkc, xNh);
}
p1.xbg=function()
{
var xIc=1;
if( (this.width > 0) && (this.height > 0) )
{
xIc=this.width/this.height;
}
return xIc;
}
p1.xo=function(xoe, xF, xtb)
{
return 2.0*180.0/Math.PI*Math.atan(xtb/xF*Math.tan(0.5*xoe*Math.PI/180.0));
}
p1.xIf=function()
{
return new Date().getTime();
}
p1.xdh=function()
{
var x1h=0;
if(this.x9d)
{
x1h=this.x9d.offsetWidth;
}
return x1h;
}
p1.xOb=function()
{
var x1h=0;
if(this.x9d)
{
x1h=this.x9d.offsetHeight;
}
return x1h;
}
p1.xVh=function()
{
var xod=this.xGg();
this.x2g(!xod);
}
nhPanoramaViewer.showNavigator=function()
{
var properties=new Array("appCodeName","appName","appVersion","buildID","oscpu","platform","product","productSub",
"userAgent","vendor","vendorSub");
var xic;
for(var xTb in properties)
{
var property=properties[xTb];
xic += property+": "+window.navigator[property]+"\n";
}
alert(xic);
}
nhPanoramaViewer.isWebKit=function()
{
return !!(window.navigator.userAgent.match(/ applewebkit\/.*/i));
}
nhPanoramaViewer.isIOS=function()
{
if(!nhPanoramaViewer.isWebKit()) return false;
return !!(window.navigator.userAgent.match(/ mobile\/.*/i));
}
nhPanoramaViewer.isIPad=function()
{
if(!nhPanoramaViewer.isIOS()) return false;
return !!(window.navigator.userAgent.match(/ipad\;/i));
}
nhPanoramaViewer.isChrome=function()
{
if(!nhPanoramaViewer.isWebKit()) return false;
return !!(window.navigator.userAgent.match(/ chrome\/.*/i));
}
nhPanoramaViewer.isFirefox=function()
{
return !!(window.navigator.userAgent.match(/ firefox\/.*/i));
}
nhPanoramaViewer.getChromeVersion=function()
{
var xuf=window.navigator.userAgent.match(/ Chrome\/([0-9]+)\.([0-9]+)\./);
var version=[0,0];
if(xuf !== null)
{
version=xuf.slice(1,3).map(function(xul){
return xul-0;
});
}
return version;
}
nhPanoramaViewer.isAndroid=function()
{
var x1h=false;
if(window.navigator.userAgent.match(/ android /i)) x1h=true;
if(window.navigator.userAgent.match(/\(android;/i)) x1h=true;
return x1h;
}
nhPanoramaViewer.isMac=function()
{
return !!(window.navigator.platform.match(/^mac/i));
}
p1.xRf=function(event)
{
this.xIe = true;
var touch=event.touches[0];
event.preventDefault();
if(event.touches.length == 1)
{
this.xvd(event.touches[0].clientX, event.touches[0].clientY);
}
else
{
if(this.xCd != this.xjf)
{
this.xhb();
}
if(event.touches.length == 2)
{
var xnd=this.x1b(event);
this.xPc=xnd[0];
this.xcf=xnd[1];
this.xVd=xnd[2];
this.xm=window.pageXOffset;
this.xqf=window.pageYOffset;
this.xCd=this.xnc;
this.xH=this.xk;
}
else
{
this.xCd=this.xjf;
}
}
}
p1.xbf=function(event)
{
event.preventDefault();
if( (this.xCd == this.x2d) || (this.xCd == this.x1c))
{
this.xMe(event.touches[0].clientX, event.touches[0].clientY);
}
else if(this.xCd == this.xnc)
{
var xQg=this.xud;
var xXb=this.xKd();
var xnd=this.x1b(event);
var xW=xnd[0];
var xii=xnd[1];
var xjb=xnd[2];
var xJ;
if(xW < 1)
{
xJ=100000;
}
else
{
xJ=this.xPc / xW;
}
var xJe=Math.tan(0.5*this.xH*Math.PI/180.0);
xJe *= xJ;
var xte=2.0*Math.atan(xJe)*180.0/Math.PI;
if(xte < xQg) xte=xQg;
if(xte > xXb) xte=xXb;
if(this.xk != xte)
{
this.xk=xte;
this.xph=0;
this.xTc();
}
if(!this.xGg())
{
var xcg=this.xcf+this.xm-xii;
var xBc=this.xVd+this.xqf-xjb;
window.scroll(xcg, xBc);
}
}
}
p1.x8e=function(event)
{
event.preventDefault();
if( (this.xCd == this.x2d) || (this.xCd == this.x1c))
{
this.xhb();
}
else if(this.xCd == this.xnc)
{
this.xCd=this.xjf;
}
}
p1.x1b=function(event)
{
var xxc=event.touches[0].clientX;
var xpi=event.touches[0].clientY;
var xce=event.touches[1].clientX;
var xsb=event.touches[1].clientY;
var xAd=xce-xxc;
var xwc=xsb-xpi;
var xTg=Math.sqrt(xAd*xAd+xwc*xwc);
var xGc=(xxc+xce)/2;
var x6h=(xpi+xsb)/2;
return new Array(xTg, xGc, x6h);
}
p1.x4f=function()
{
var xmb=document.getElementsByTagName("meta");
for(var i=0; i < xmb.length; i++)
{
var xYh=xmb[i];
if(xYh.name ==="viewport") return xYh;
}
return null;

}
p1.xMc=function()
{
var x1h="";
var xYh=this.x4f();
if(xYh)
{
x1h=xYh.getAttribute("content");
}
return x1h;
}
p1.xJg=function(content)
{
var xYh=this.x4f();
if(!xYh)
{
xYh=document.createElement("meta");
xYh.setAttribute("name","viewport");
document.head.appendChild(xYh);
}
xYh.setAttribute("content",content);
}
p1.xGd=function()
{
var isfullscreen=(document.fullscreenElement || document.mozFullScreenElement || document.webkitFullscreenElement);
this.xgi=isfullscreen;
if(isfullscreen) this.m_TrueFullScreen=true;
this.xcd();
}
p1.xOd=function(xod)
{
if(this.xgi != xod)
{
var done=false;
if(xod)
{
if(document.fullscreenEnabled || document.mozFullScreenEnabled || document.webkitFullscreenEnabled)
{
var xDg = this.x3f;
if (xDg.requestFullscreen) {
xDg.requestFullscreen();
done=true;
}else if (xDg.mozRequestFullScreen) {
xDg.mozRequestFullScreen();
done=true;
}else if (xDg.webkitRequestFullscreen) {
xDg.webkitRequestFullscreen();
done=true;
}
}
}
else
{
if(this.m_TrueFullScreen)
{
if (document.cancelFullScreen) {
document.cancelFullScreen();
}else if (document.mozCancelFullScreen) {
document.mozCancelFullScreen();
}else if (document.webkitCancelFullScreen) {
document.webkitCancelFullScreen();
}
done=true;
}
}
if(done)
{
this.xTc();
}
else
{
this.m_TrueFullScreen=false;
var xad=this;
if(nhPanoramaViewer.isIOS())
{
xad.xSg=true;
xad.xqb(xad.xRd, xad.x9d);
xad.xRd.style.visibility="visible";
setTimeout(function(){
xad.xSg=false;
xad.xac(xod);
xad.xRd.style.visibility="hidden";
},100);
}
else
{
xad.xac(xod);
}
}
}
}
p1.xac=function(xod)
{
if(this.xgi != xod)
{
if(xod)
{
this.xab=document.body;
this.xNd=document.documentElement.style.cssText;
var xad=this;
var xN=document.createElement("body");
xN.appendChild(xad.x3f);
xN.style.margin="0px";
xN.style.padding="0px";
xN.style.width="100%";
xN.style.height="100%";
document.body=xN;
document.documentElement.style.cssText="width:100%;height:100%";
window.scroll(100000,0);
xad.x3f.style.visibility="hidden";
setTimeout(function(){
xad.x3f.style.visibility="visible";
},1);
xad.xA();
}
else
{
document.body=this.xab;
document.documentElement.style.cssText=this.xNd;
this.xlf.appendChild(this.x3f);
this.xA();
}
this.xgi=xod;
this.xcd();
}
}

p1.xzh=function(xSh)
{
var x1h="";
for(var i=0; i < xSh.length; i++)
{
var xfk=xSh.charCodeAt(i);
if( (xfk >= 48) && (xfk < 128) )
{
xfk=((xfk-48))^0x46+48;
}
x1h += String.fromCharCode(xfk);
}
return x1h;
}
nhPanoramaViewer.isSupported=function()
{
if(!document.addEventListener) return false;
if(nhPanoramaViewer.has3dCss()) return true;
if(nhPanoramaViewer.hasWebGL()) return true;
return false;
}
nhPanoramaViewer.has3dCss=function()
{
var xS=document.createElement("div");
if(!xS) return false;
if(typeof xS.style.webkitPerspective =="string") {}
else if(typeof xS.style.MozPerspective =="string") {}
else return false;
if(nhPanoramaViewer.isChrome())
{
var chromeversion=nhPanoramaViewer.getChromeVersion();
if(chromeversion[0]-0 < 22) return false;
}
if(window.navigator.userAgent.match(/ firefox\/.*/i))
{
if(window.navigator.userAgent.match(/[^xWj-zA-Z]linux[^xWj-zA-Z]/i))
{
return false;
}
}
return true;
}
nhPanoramaViewer.hasWebGL=function()
{
var xch=null;
var xXd=document.createElement("canvas");
try
{
xch = xXd.getContext("webgl");
}
catch(xge) {}
if(!xch)
{
try
{
xch = xXd.getContext("experimental-webgl");
}
catch(xge) {}
}
return (xch != null);
}
p1.x8c=function(xhf)
{
var xch;
try
{
xch = xhf.getContext("webgl");
}
catch(xge) {}
if(!xch)
{
try
{
xch = xhf.getContext("experimental-webgl");
}
catch(xge) {}
}
if(!xch)
{
throw new Error("Could not initialize WebGL");
}
this.x4c=xch;
xch.clearColor(0.0, 0.0, 0.0, 1.0);
this.xae("s1-1a");
xch.enable(xch.DEPTH_TEST);
this.xae("s1-1b");
xch.depthFunc(xch.LEQUAL);
this.xae("s1-1c");
xch.clearDepth(1.0)
this.xae("s1-1d");
var xSb="attribute vec3 vertexPosition;attribute vec2 vTexCoord;uniform mat4 modelViewMatrix,perspectiveMatrix;varying vec2 v_texCoord;void main(){gl_Position = perspectiveMatrix * modelViewMatrix * vec4(vertexPosition, 1.0);v_texCoord = vTexCoord;}";
var xHc="uniform sampler2D sampler2d; varying mediump vec2 v_texCoord;void main(void){gl_FragColor = texture2D(sampler2d, v_texCoord);}";
this.x1e=this.xwd(xSb,xHc);
this.xK=new x4j();
this.xUf=new x4j();
this.xng=xch.getUniformLocation(this.x1e,"modelViewMatrix");
this.xae("s1-2");
this.xGb=xch.getUniformLocation(this.x1e,"perspectiveMatrix");
this.xae("s1-3");
this.xBb = xch.getAttribLocation(this.x1e,"vertexPosition");
this.xae("s1-4");
xch.enableVertexAttribArray(this.xBb);
this.xae("s1-5");
this.xrh = xch.getAttribLocation(this.x1e,"vTexCoord");
this.xae("s1-6");
xch.enableVertexAttribArray(this.xrh);
this.xae("s1-7");
var loc=xch.getUniformLocation(this.x1e,"sampler2d");
this.xae("s1-10");
xch.uniform1i(loc, 0);
this.xae("s1-11");
}
p1.xae=function(xog)
{
var xQf=this.x4c.getError();
if(xQf != this.x4c.NO_ERROR)
{
throw new Error("webGL error: "+xog+": "+xQf);
}
}
p1.xbh=function(xyg, x3e)
{
var xch=this.x4c;
var x2h=xch.createShader(xyg);
this.xae("s2-1");
xch.shaderSource(x2h, x3e);
this.xae("s2-2");
xch.compileShader(x2h);
this.xae("s2-3");
if(!xch.getShaderParameter(x2h, xch.COMPILE_STATUS))
{
var xsg=xch.getShaderInfoLog(x2h);
xch.deleteShader(x2h);
throw new Error("Couldn't compile shader:\n"+xsg);
}
return x2h;
}
p1.xwd=function(xAf, xHc)
{
var xch=this.x4c;
var xC=null;
var xJb=null;
var xmh=null;
try
{
xJb=this.xbh(xch.VERTEX_SHADER, xAf);
xmh=this.xbh(xch.FRAGMENT_SHADER, xHc);
var xC = xch.createProgram();
this.xae("s3-1");
xch.attachShader(xC, xJb);
this.xae("s3-2");
xch.attachShader(xC, xmh);
this.xae("s3-3");
xch.linkProgram(xC);
this.xae("s3-4");
if(!xch.getProgramParameter(xC, xch.LINK_STATUS))
{
var xsg=xch.getProgramInfoLog(xC);
throw new Error("Couldn't link program:\n"+xsg);
}
xch.useProgram(xC);
this.xae("s3-5");
}
catch(xge)
{
try
{
if(xJb) xch.deleteShader(xJb);
if(xmh) xch.deleteShader(xmh);
if(xC) xch.deleteProgram(xC);
}catch(xwk) {}
throw xge;
}
return xC;
}
p1.xY=function()
{
if(this.xWe)
{
this.xWe=false;
var xch=this.x4c;
xch.clear(xch.COLOR_BUFFER_BIT | xch.DEPTH_BUFFER_BIT);
var x7h=this.xAh();
if(this.xKc)
{
for(var i=0; i < x7h; i++)
{
var xBd=this.xKc[i];
if(xBd)
{
var x1d=xBd.xMj();
if(x1d)
{
xch.bindTexture(xch.TEXTURE_2D, x1d[0]);
xch.bindBuffer(xch.ARRAY_BUFFER, x1d[1]);
xch.vertexAttribPointer(this.xBb, 3.0, xch.FLOAT, false, 0, 0);
xch.bindBuffer(xch.ARRAY_BUFFER, x1d[2]);
xch.vertexAttribPointer(this.xrh, 2.0, xch.FLOAT, false, 0, 0);
xch.drawArrays(xch.TRIANGLE_STRIP, 0, 4);
}
}
}
}
xch.flush();
this.xae("s5-6");
xch.finish();
this.xae("s5-7");
}
}
p1.xug=function(x8)
{
var xch=this.x4c;
var xFd = xch.createBuffer();
this.xae("s5-1");
xch.bindBuffer(xch.ARRAY_BUFFER, xFd);
this.xae("s5-2");
xch.bufferData(xch.ARRAY_BUFFER, new Float32Array(x8), xch.STATIC_DRAW);
this.xae("s5-3");
return xFd;
}
p1.xDf=function(xLc)
{
var xch=this.x4c;
var xni=xch.createTexture();
this.xae("s7-1");
xch.bindTexture(xch.TEXTURE_2D, xni);
this.xae("s7-2");
xch.pixelStorei(xch.UNPACK_FLIP_Y_WEBGL, true);
xch.texParameteri(xch.TEXTURE_2D, xch.TEXTURE_MIN_FILTER, xch.LINEAR);
xch.texParameteri(xch.TEXTURE_2D, xch.TEXTURE_MAG_FILTER, xch.LINEAR);
xch.texParameteri(xch.TEXTURE_2D, xch.TEXTURE_WRAP_S, xch.CLAMP_TO_EDGE);
xch.texParameteri(xch.TEXTURE_2D, xch.TEXTURE_WRAP_T, xch.CLAMP_TO_EDGE);
this.xae("s7-3");
try
{
xch.texImage2D(xch.TEXTURE_2D, 0, xch.RGBA, xch.RGBA, xch.UNSIGNED_BYTE, xLc);
}
catch(xge)
{
if( (xge.name =="SecurityError")
&& (nhPanoramaViewer.isChrome())
&& window.location.href.match(/^file\:\/\/.*/)
&& xLc.src.match(/^file\:\/\/.*/) )
{
throw new Error("Failed to load panorama. Due to security restrictions in Chrome the panorama viewer cannot access images stored locally on your computer."
+" To resolve the problem, upload the panorama to a web server and access it over the web. Or launch Chrome with the --allow-file-access-from-files flag"
+" (google for more information) to disable this security restriction.\n\n"
+"Note that this error will not appear when the panorama is viewed on the web."
+"\n\nDetails: "+xge.message
);
}
else
{
throw xge;
}
}
this.xae("s7-4");
return xni;
}
nhPanoramaViewer.requestAnimationFrameFunc=null;
nhPanoramaViewer.requestAnimationFrame=function(callback, element)
{
if(!nhPanoramaViewer.requestAnimationFrameFunc)
{
var xOe = [
"mozRequestAnimationFrame",
"oRequestAnimationFrame",
"requestAnimationFrame",
"webkitRequestAnimationFrame",
"msRequestAnimationFrame"
];
for (var i = 0; i < xOe.length; ++i)
{
if(window[xOe[i]])
{
var thefunc=window[xOe[i]];
nhPanoramaViewer.requestAnimationFrameFunc=function(callback,element) {
thefunc.call(window, callback, element);
};
break;
}
}
if(!nhPanoramaViewer.requestAnimationFrameFunc)
{
nhPanoramaViewer.requestAnimationFrameFunc=function(callback,element) {
window.setTimeout(callback,16.67);
};
}
}
nhPanoramaViewer.requestAnimationFrameFunc(callback,element);
}


p1.xve=function(xge)
{
var xvb=this.xIf() / 1000.0;
var deltanow=0.01;
if(this.m_PrevDeviceMotionTime)
{
deltanow=xvb-this.m_PrevDeviceMotionTime;
}
this.m_PrevDeviceMotionTime=xvb;
if(xge.rotationRate && xge.accelerationIncludingGravity)
{
var xci=xge.rotationRate;
var xvg=xge.accelerationIncludingGravity;
var interval=deltanow;
if( (!isNaN(xvg.x)) && (!isNaN(xvg.y)) && (!isNaN(xvg.z))
&& (!isNaN(xci.alpha)) && (!isNaN(xci.beta)) && (!isNaN(xci.gamma))
&& (!isNaN(interval)) )
{
if(this.xFb == 0)
{
this.xFb=xvb+1.0;
}
if(xvb >= this.xFb)
{
var xth=[xvg.x, xvg.y, xvg.z];
if(this.m_gravityReversed)
{
xth[0]=-xth[0];
xth[1]=-xth[1];
xth[2]=-xth[2];
}
if(this.xQh != null)
{
var xZf=this.xBe;
xZf=Math.pow(xZf,interval);
var xob=1.0-xZf;
xth[0]=xob*xth[0]+xZf*this.xQh[0];
xth[1]=xob*xth[1]+xZf*this.xQh[1];
xth[2]=xob*xth[2]+xZf*this.xQh[2];
}
this.xQh=xth;
var x4=Math.sqrt(xth[0]*xth[0]+xth[1]*xth[1]+xth[2]*xth[2]);
if(x4 > 0)
{
var xOc=1.0/x4;
xth[0] *= xOc;
xth[1] *= xOc;
xth[2] *= xOc;
}
this.xZg=xth;

var xag=Math.asin(xth[2]);
var xnf=0;
if( (xth[0] != 0) || (xth[1] != 0) )
{
xnf=Math.atan2(xth[0],-xth[1]);
}
xnf *= 180.0/Math.PI;
xag *= 180.0/Math.PI;
if(this.xCd == this.xjf)
{
if(this.x7d == this.xne)
{
var xRb=xth[0]-this.xdi[0];
var xEd=xth[1]-this.xdi[1];
var xGh=xth[2]-this.xdi[2];
var xP=xRb*xRb+xEd*xEd+xGh*xGh;
if(xP > 0.1)
{
this.xCh(xag);
}
}
else if(this.x7d == this.x6g)
{
if(xag > -60)
{
this.xCh(xag);
}
}
}
if(this.x7d == this.x4e)
{
if( (Math.abs(xci.alpha) > 20)
|| (Math.abs(xci.beta) > 20)
|| (Math.abs(xci.gamma) > 20) )
{
this.xVc();
}
}
var xr=xci.alpha;
var xu=xci.beta;
var xD=xci.gamma;
xr *= interval;
xu *= interval;
xD *= interval;
if(this.m_rotationRateRadians)
{
xr *= 180.0/Math.PI;
xu *= 180.0/Math.PI;
xD *= 180.0/Math.PI;
}
var x3d=new x4j();
var xMf=new x4j();
xMf.xhk(2,xD);
x3d.xik(xMf);
xMf.xhk(1,xu);
x3d.xik(xMf);
xMf.xhk(0,xr);
x3d.xik(xMf);
var xbe=new x4j();
xMf.xhk(2,-xnf);
xbe.xik(xMf);
xMf.xhk(0,xag);
xbe.xik(xMf);
var x1f=new x4j(xbe);
x1f.xjk();
var xHg=new x4j();
xHg.xik(x1f);
xHg.xik(x3d);
xHg.xik(xbe);
var x5b=xHg.x8j([1,0,0]);
var x7=Math.atan2(x5b[2],x5b[0]);
x7 *= 180.0/Math.PI;
var x0g=this.x3g;
if(this.xVg == 0)
{
x0g += x7;
}
var xXc;
if( (this.xCd == this.xjf)
&& (this.x7d == this.x4e)
)
{
var xDc=interval*180;
if(this.xMg > 0)
{
this.xMg -= xDc;
if(this.xMg < 0) this.xMg=0;
}
else if(this.xMg < 0)
{
this.xMg += xDc;
if(this.xMg > 0) this.xMg=0;
}
xXc=xag+this.xMg;
if(xXc < -90) xXc=-90;
if(xXc > 90) xXc=90;
}
else
{
xXc=this.xw;
}
if( (!isNaN(x0g)) && (!isNaN(xXc)))
{
this.xZe(x0g,xXc,this.xk);
}
}
}
}
}
p1.xWg=function(xge)
{
this.log("Error: WebGL context lost");
}
p1.xFe=function(xge)
{
this.log("WebGL context restored");
}
p1.xfd=function()
{
return (this.x7d == this.x4e);
}
p1.xTd=function()
{
if(this.x7d != this.x6g)
{
this.xdi=this.xZg;
this.x7d=this.xne;
}
}
p1.xCh=function(x0f)
{
if(x0f < -60)
{
this.x7d=this.x6g;
}
else
{
this.x7d=this.x4e;
this.xMg=this.xw-x0f;
this.xVc();
}
}
p1.xCc=function()
{
var xNg="The publisher of this panorama should check the contents of the 'licensekey' field in the parameters for this panorama.";
if(this.xee < 0)
{
this.xee=0;
if(this.xib !="")
{
var x3c=this.xjc(this.xib);
if(x3c.valid)
{
var xei=this.xih();
if(xei =="")
{
this.log("License key ('licensekey' field) ignored since the panorama is viewed on the local computer.");
}
else
{
var xmc=false;
if(xei == x3c.host)
{
xmc=true;
}
else
{
var xZb="."+x3c.host;
var xZd=xei.lastIndexOf(xZb);
if( (xZd >= 0) && (xZd == (xei.length-xZb.length)) )
{
xmc=true;
}
}
if(xmc)
{
this.xee=1;
}
else
{
this.log("Invalid license: the license is valid for '"+x3c.host+"' but the panorama is stored on '"+xei+"'. "+xNg);
}
}
}
else
{
this.log("Invalid license key. "+xNg);
}
}
}
return (this.xee > 0);
}
p1.xVb=function(xpd)
{
var valid=false;
var xZd=xpd.lastIndexOf(":");
if(xZd >= 0)
{
var xic=xpd.substr(0,xZd);
var xYb=xpd.substr(xZd+1,xpd.length-xZd-1);
var xrd=new xOm(this.x4d);
var xbi=new xOm(this.xLb);
var xJc=new xqp();
xJc.xfn(xrd, xbi);
valid=xJc.x6o(xic, xYb);
}
return valid;
}
p1.xjc=function(xpd)
{
var x1h=new Object();
try
{
x1h.valid=this.xVb(xpd);
}
catch(xge)
{
x1h.valid=false;
}
if(x1h.valid)
{
var components=xpd.split(":");
if(components.length < 3)
{
x1h.valid=false;
}
else
{
x1h.host=components[0];
x1h.version=components[1];
}
}
return x1h;
}
p1.xx8944hjkxx7jk=function(xmf, xah)
{
xmf=xmf.toLowerCase();
var xic=xmf.toLowerCase()+":1";
var xbi=new xOm(this.xLb);
var xhh=new xOm(xah);
var xrd=new xOm(this.x4d);
var xJc=new xqp();
xJc.xLn(xhh, xbi);
xJc.xfn(xrd, xbi);
var xYb=xJc.xpp(xic,true);
var xEf=xic+":"+xYb;
var xub=this.xjc(xEf);
if(!xub.valid)
{
xub=this.xjc(xEf);
throw new Error("Check failed");
}
return xEf;
}
p1.xih=function()
{
var xpg=this.xNe(0);
var xxe=this.xi();
xpg=this.xzc(xpg,xxe);
var host="";
if(xpg.indexOf("://") >= 0)
{
host=xpg.replace(new RegExp("^.*:\\/\\/"),"");
host=host.replace(new RegExp("\\/.*$"),"");
host=host.replace(new RegExp(":.*$"),"");
}
host=host.toLowerCase();
return host;
}

var p2=xDi.prototype;
p2.lsNotLoaded=0;
p2.x6i=1;
p2.xij=2;
p2.xkj=3;
p2.x9b=false;
p2.xoj=0;
function xDi(xLj, xQi, xtf, xag, xDd, xPg, xdg)
{
this.xKj=this.lsNotLoaded;
this.xEj=xLj;
this.xsi=xQi;
this.xzi=xtf;
this.xPi=xag;
this.x7i=xDd;
this.xLi=xPg;
this.xJj=xdg;
if(this.xEj.xEb)
{
var x9g=document.createElement("div");
x9g.style.position="absolute";
x9g.style.msBackfaceVisibility=x9g.style.webkitBackfaceVisibility=x9g.style.MozBackfaceVisibility="hidden";
x9g.style.MozTransformStyle="preserve-3d";
x9g.style.top="0px";
x9g.style.left="0px";
var xaj=xLj.xPf();
xaj.appendChild(x9g);
this.x9d=x9g;
}
if(this.xEj.xTf)
{
this.x8i();
}
var xZh=document.createElement("img");
xZh.style.position="absolute";
xZh.style.top="0px";
xZh.style.left="0px";
xZh.style.visibility="hidden";
this.xhj=xZh;
var xad=this;
if(document.addEventListener)
{
xZh.addEventListener("load", function(xge){return xad.xsj(xge? xge : window.event)}, false);
xZh.addEventListener("error", function(xge){return xad.xZi(xge? xge : window.event)}, false);
}
else if(document.attachEvent)
{
xZh.attachEvent("onload", function(xge){return xad.xsj(xge? xge : window.event)});
xZh.attachEvent("onerror", function(xge){return xad.xZi(xge? xge : window.event)});
}
if(this.xEj.xEb)
{
this.x9d.appendChild(this.xhj);
var x2i=document.createElement("canvas");
x2i.style.position="absolute";
x2i.style.top="0px";
x2i.style.left="0px";
x2i.style.visibility="hidden";
x9g.appendChild(x2i);
this.xSj=x2i;
}
this.xFj();
}
p2.x8i=function()
{
var xTg=10;
var width=xTg*Math.tan(0.5*this.x7i*Math.PI/180);
var x1i=new x4j();
x1i.xhk(0,this.xPi);
var xlg=new x4j();
xlg.xhk(1,-this.xzi);
x1i.xik(xlg);
var xSi=[];
for(var xBi=0; xBi < 4; xBi++)
{
var xwi=[];
xwi[0]=(xBi & 1)? -width : width;
xwi[1]=(xBi & 2)? -width : width;
xwi[2]=-xTg;
xwi=x1i.x8j(xwi);
xSi=xSi.concat(xwi);
}
this.xfj=this.xEj.xug(xSi);
}
p2.xHj=function()
{
this.xFi();
}
p2.xFi=function()
{
this.xKj=this.x6i;
if(this.xoj > 0)
{
var xad=this;
window.setTimeout(function(){xad.xhj.src=xad.xsi}, this.xoj*1000);
}
else
{
this.xhj.src=this.xsi;
}
}
p2.xZi=function(event)
{
this.xEj.xeh("Failed to load image: "+this.xsi);
this.xKj=this.xkj;
this.xEj.xji(this);
return true;
}
p2.xsj=function(event)
{
this.xKj=this.xij;
if(this.xhj.width != this.xhj.height)
{
this.xEj.xeh("Image "+this.xsi+" should be square");
}
var xwj=this.xhj.width;
if(this.xJj && (this.xhj.width > this.xJj))
{
this.xhj.width=this.xJj;
this.xhj.height=this.xJj;
var xad=this;
}
this.xQj=new Array(this.xhj.width, this.xhj.height);
if(this.xEj.xEb)
{
this.xA();
this.xSj.style.visibility="hidden";
this.xhj.style.visibility="visible";
this.x9d.style.width=this.xQj[0]+"px";
this.x9d.style.height=this.xQj[1]+"px";
}
else
{
this.xdj=this.xEj.xDf(this.xhj);
this.x5i(0.0, 0.0, 1.0, 1.0);
}
if(nhPanoramaViewer.isIOS())
{
var xad=this;
setTimeout(function(){
xad.xEj.xji(this);
},100);
}
else
{
this.xEj.xji(this);
}
return true;
}
p2.xFj=function()
{
}
p2.xgj=function(event)
{
try
{
xUj(this.xti,false);
this.xti=null;
this.xEj.xji(this);
}
catch (xWb)
{
this.xEj.xeh(xWb.toString());
}
}
p2.xA=function()
{
if((this.xKj == this.xij) || this.x9b)
{
this.x9i();
}
}
p2.x9i=function()
{
if(this.xEj.xEb)
{
var xuj=this.xEj.xHf();
var xri=this.xEj.x5g();
var xTj=this.xEj.xdh();
var xmj=this.xEj.xOb();
var xDj=this.xQj[0];
var xnj=this.xQj[1];
var xRi=1000.0*(this.xLi+1);
var ownerstyle=this.xEj.xPf().style;
var xGi=1;
if(typeof ownerstyle.webkitPerspective =="string")
{
xGi=ownerstyle.webkitPerspective;
}
else if(typeof ownerstyle.MozPerspective =="string")
{
xGi=ownerstyle.MozPerspective;
}
else
{
xGi=ownerstyle.msPerspective;
}
xGi=xGi.replace(/\s*px\s*$/,"");
xGi=xGi-0;
var xNi=0.5*xRi/Math.tan(0.5*this.x7i*Math.PI/180);

var xAi="translate3d("+(-(xDj-xTj)/2).toFixed(4)+"px,"+(-(xnj-xmj)/2).toFixed(4)+"px,"+xGi.toFixed(4)+"px)"
+" rotateX("+xri.toFixed(4)+"deg)"
+" rotateY("+(xuj-this.xzi).toFixed(4)+"deg)"
+" rotateX("+(-this.xPi).toFixed(4)+"deg)"
+" translate3d(0px,0px,"+(-xNi).toFixed(4)+"px)"
+" scale3d("+(xRi/xDj).toFixed(4)+","+(xRi/xnj).toFixed(4)+",1)";
this.x9d.style.msTransform=this.x9d.style.webkitTransform=this.x9d.style.MozTransform=xAi;
}
}
p2.xMi=function()
{
return this.xKj;
}
p2.xBj=function()
{
return this.x9b;
}
p2.x3i=function()
{
return this.xzi;
}
p2.xGj=function()
{
return this.xPi;
}
p2.xKi=function(x2i, xt)
{
this.x9b=true;
if(this.xKj != this.x6i) this.xKj=this.lsNotLoaded;
var xUb=xt[2];
var x4i=xt[3];
var previewimage=this.xSj;
previewimage.width=xUb;
previewimage.height=x4i;
var xXi = previewimage.getContext('2d');
xXi.drawImage(x2i, xt[0], xt[1], xUb, x4i, 0, 0, xUb, x4i);
previewimage.style.visibility="visible";
this.x9d.style.width=previewimage.width+"px";
this.x9d.style.height=previewimage.height+"px";
this.xQj=new Array(previewimage.width,previewimage.height);
this.xA();
}
p2.xCj=function(xvj, xDj, xt)
{
this.xdj=xvj;
var xJi=xt[0]/xDj;
var xvi=(xt[0]+xt[2])/xDj;
var xUi=1.0-(xt[1]+xt[3])/xDj;
var xOj=1.0-xt[1]/xDj;
this.x5i(xJi, xUi, xvi, xOj);
this.x9b=true;
if(this.xKj != this.x6i) this.xKj=this.lsNotLoaded;
}
p2.x5i=function(xJi, xUi, xvi, xOj)
{
this.xyj=this.xEj.xug([xvi, xOj, xJi, xOj, xvi, xUi, xJi, xUi]);
}
p2.xMj=function()
{
if(this.xdj)
{
return [this.xdj, this.xfj, this.xyj];
}
else
{
return null;
}
}

var p3=x4j.prototype;
p3.xkk=[1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1];
function x4j(src)
{
if(src)
{
this.xkk=src.xkk.slice(0);
}
}
p3.xik=function(xok)
{
var xXj=[];
var xck=0;
var xdk=0;
var xWj;
var x3j;
var xek;
while(true)
{
xWj=0;
x3j=xck;
xek=xdk;
while(true)
{
xWj += this.xkk[x3j++]*xok.xkk[xek];
xek += 4;
if(xek >= 16) break;
}
xXj.push(xWj);
xdk++;
if(xdk == 4)
{
xck += 4;
if(xck == 16) break;
xdk=0;
}
}
this.xkk=xXj;
return this;
}
p3.x1j=function(x9e, xIc, xnk, xmk)
{
var xyf=0.5 * x9e * Math.PI / 180.0;
var xUi=xnk * Math.tan(xyf) / Math.sqrt(1+xIc*xIc);
var xvi=xUi*xIc;
var xlk=1.0/(xmk-xnk);
this.xkk = [
xnk/xvi, 0, 0, 0,
0, xnk/xUi, 0, 0,
0, 0, -(xnk+xmk)*xlk, -1,
0, 0, -2*xmk*xnk*xlk, 0
];
return this;
}
p3.xhk=function(xak,xgk)
{
var xbk=Math.PI * xgk / 180.0;
var xfk=Math.cos(xbk);
var s=Math.sin(xbk);
if(xak == 0)
{
this.xkk = [
1, 0, 0, 0,
0, xfk, s, 0,
0, -s, xfk, 0,
0, 0, 0, 1
];
}
else if(xak == 1)
{
this.xkk = [
xfk, 0, -s, 0,
0, 1, 0, 0,
s, 0, xfk, 0,
0, 0, 0, 1
];
}
else
{
this.xkk = [
xfk, s, 0, 0,
-s, xfk, 0, 0,
0, 0, 1, 0,
0, 0, 0, 1
];
}
return this;
}
p3.x6j=function()
{
return new Float32Array(this.xkk);
}
p3.x8j=function(x2j)
{
var xXj=this.xkk;
var x=xXj[0]*x2j[0]+xXj[4]*x2j[1]+xXj[8]*x2j[2]+xXj[12];
var y=xXj[1]*x2j[0]+xXj[5]*x2j[1]+xXj[9]*x2j[2]+xXj[13];
var z=xXj[2]*x2j[0]+xXj[6]*x2j[1]+xXj[10]*x2j[2]+xXj[14];
var xWh=xXj[3]*x2j[0]+xXj[7]*x2j[1]+xXj[11]*x2j[2]+xXj[15];
if(xWh != 1.0)
{
var x9j=1.0/xWh;
x *= x9j;
y *= x9j;
z *= x9j;
}
return [x,y,z];
}
p3.xjk=function()
{
var xXj=this.xkk;
this.xkk=[
xXj[0], xXj[4], xXj[8], xXj[12],
xXj[1], xXj[5], xXj[9], xXj[13],
xXj[2], xXj[6], xXj[10], xXj[14],
xXj[3], xXj[7], xXj[11], xXj[15]
];
return this;
}

var p4=xOm.prototype;

p4.xxm="";
p4.xal=false;
p4.xNl=14;

function xOm(value)
{
this.xMm=Math.floor(Math.pow(10,this.xNl-1)+0.1);
var xJm=typeof value;
if( (xJm =="undefined") || (value === null) )
{
}
else if(xJm =="number")
{
this.xEm(value);
}
else if(xJm =="string")
{
this.xLm(value);
}
else if(xJm =="object")
{
if(value instanceof xOm)
{
this.x7m(value);
}
else
{
var xWm="(unknown)";
if(value && value.constructor && value.constructor.toString)
{
xWm=value.constructor.toString();
}
throw new Error("Invalid type: "+xWm);
}
}
else
{
throw new Error("Invalid type: "+xJm);
}
}
p4.x7m=function(xul)
{
this.xxm=xul.xxm;
this.xal=xul.xal;
}
p4.toString=function()
{
if(this.xal)
{
return"-"+this.xxm;
}
else
{
return this.xxm;
}
}
p4.xAl=function()
{
return (this.xxm =="");
}
p4.xQm=function(value, x2k)
{
this.xxm=this.xJk(value);
if(this.xAl()) x2k=false;
this.xal=x2k;
}
p4.xLm=function(value)
{
var x2k=false;
if(value.charAt(0) =="-")
{
x2k=true;
value=value.substr(1);
}
if(! value.match(/^[0-9]*$/))
{
throw new Error("Invalid value");
}
value=this.xJk(value);
if(value =="")
{
x2k=false;
}
this.xxm=value;
this.xal=x2k;
}
p4.xAk=function(xyl, xZm, length)
{
var x3l=xyl.length-xZm;
if(x3l <= 0)
{
return 0;
}
else
{
var xtm=x3l-length;
if(xtm < 0) xtm=0;
var substr=xyl.substring(xtm,x3l);
substr=substr.replace(/^0+/,"");
if(substr.length == 0) return 0;
return parseInt(substr);
}
}

p4.xNm=function(i, length)
{
var x1h=""+i;
x1h=this.xwm(length-x1h.length)+x1h;
return x1h;
}
p4.xWl=function(xrl, xzk)
{
xrl=this.xJk(xrl);
xzk=this.xJk(xzk);
if(xrl.length > xzk.length) return 1;
if(xrl.length < xzk.length) return -1;
var xJl=xrl.length;
var xLk, xkm;
for(var i=0; i < xJl; i++)
{
xLk=xrl.charCodeAt(i);
xkm=xzk.charCodeAt(i);
if(xLk > xkm) return 1;
if(xLk < xkm) return -1;
}
return 0;
}
p4.xbn=function(s)
{
var x8m=s.length;
var xRl=0;
var xgl;
while(x8m > 0)
{
xgl=x8m-1;
if(s.charAt(xgl) !="0") break;
xRl++;
x8m--;
}
if(xRl > 0)
{
s=s.substr(0,x8m);
}
return [s,xRl];
}
p4.xJk=function(s)
{
var xBk=0;
while(xBk < s.length)
{
if(s.charAt(xBk) !="0") break;
xBk++;
}
if(xBk > 0)
{
return s.substr(xBk);
}
else
{
return s;
}
}
p4.xfm=function(xKm,xJl)
{
if(xKm.length < xJl)
{
xKm=this.xwm(xJl-xKm.length)+xKm;
}
return xKm;
}
p4.xwm=function(xDk)
{
var s="000000000000000000000000000000000000000000000000000000000";
var x1h="";
while(x1h.length < xDk)
{
x1h += s.substr(0,xDk-x1h.length);
}
return x1h;
}
p4.xAm=function(xrl)
{
if(xrl < 0.0)
{
throw new Error("Negative");
}
if(xrl < 1.0)
{
return"";
}
var xPm=""+xrl;
if(/^[0-9]+$/.test(xPm))
{
return xPm;
}
else
{
var exp=Math.floor(Math.log(xrl)/Math.log(10))+1;
xrl *= Math.pow(10,-exp);
if(xrl >= 1.0)
{
exp += 1;
xrl *= 0.1;
}
else if(xrl < 0.1)
{
exp -= 1;
xrl *= 10;
}
var xSl=""+xrl;
if(xSl.substr(0,2) !="0.")
{
throw new Error("Internal error");
}
xSl=xSl.substr(2);
if(xSl.length < exp)
{
xSl += this.xwm(exp-xSl.length);
}
else
{
xSl=xSl.substr(0,exp);
}
return xSl;
}
}
p4.xMk=function(s)
{
s=this.xJk(s);
if(s =="")
{
return 0.0;
}
else
{
var xSm=17;
if(s.length > xSm)
{
return parseFloat(s.substr(0,xSm))*Math.pow(10,s.length-xSm);
}
else
{
return parseFloat(s);
}
}
}
p4.x9m=function()
{
var xrl=this.xxm;
var x1h="";
var xHl=this.xNl-1;
var xbl=this.xMm;
var xDm=Math.floor(1+(xrl.length-1)/xHl);
var xZm=(xDm-1)*xHl;
var xTl;
var x6k=0;
for(var xOl=0; xOl < xDm; xOl++)
{
xTl=this.xAk(xrl,xZm,xHl);
xTl += x6k;
x6k=(xTl & 1)? xbl : 0;
xTl=Math.floor(0.5*xTl);
x1h += this.xNm(xTl, xHl);
xZm -= xHl;
}
var xzl=new xOm();
if(x6k != 0)
{
xzl.xxm="1";
xzl.xal=this.xal;
}
this.xxm=this.xJk(x1h);
return xzl;
}
p4.xil=function(x9l, xDl)
{
var xZl=17;
var x7k=1e17;
var xGk=0;
var xrl=new xOm(x9l);
var xzk=new xOm(xDl);
if(xrl.xxm.length > xZl)
{
xGk += xrl.xxm.length-xZl;
xrl.xxm=xrl.xxm.substr(0,xZl);
}
if(xzk.xxm.length > xZl)
{
xGk -= xzk.xxm.length-xZl;
xzk.xxm=xzk.xxm.substr(0,xZl);
}
var xGm=xrl.xqk();
var x3m=xzk.xqk();
var xcm=xGm/x3m;
xcm *= x7k;
xGk -= xZl;
var xBm=new xOm(xcm);
if(xGk > 0)
{
xBm.xxm += this.xwm(xGk);
}
else
{
var xJl=xBm.xxm.length;
if(xJl <= -xGk)
{
xBm.xEm(0);
}
else
{
xBm.xxm=xBm.xxm.substr(0,xJl+xGk);
}
}
return xBm;
}
p4.xvl=function(xml)
{
if(xml.xAl())
{
throw new Error("Divide by zero");
}
if( (xml.xxm =="2") && (xml.xal == false) )
{
return this.x9m();
}
var xBm=new xOm();
var xzl=new xOm(this);
var xPl;
while(true)
{
if(xzl.xAl())
{
break;
}
xPl=this.xil(xzl,xml);
if(xPl.xAl())
{
if(this.xal != xzl.xal)
{
if(xzl.xal == xml.xal)
{
xPl.xEm(1);
}
else
{
xPl.xEm(-1);
}
}
else
{
break;
}
}
xBm=xBm.x4l(xPl);
xzl=xzl.xCl(xPl.xQl(xml));
}
this.x7m(xBm);
return xzl;
}
p4.xCm=function(xrl, xzk)
{
xrl=this.xJk(xrl);
xzk=this.xJk(xzk);
var x6l=this.xWl(xrl,xzk);
if(x6l == 0) return ["",false];
var x2k=false;
if(x6l < 0)
{
var xJm=xzk;
xzk=xrl;
xrl=xJm;
x2k=true;
}
var x1h="";
var x1d=this.xbn(xzk);
var xnm=x1d[1];
if(xnm > 0)
{
xzk=x1d[0];
var x2m=xrl.length-xnm;
x1d=this.xfl(xrl,x2m);
x1h=x1d[1]+x1h;
xrl=x1d[0];
}
var xHl=this.xNl-1;
var xel=this.xMm;
var xHm=xrl.length;
var xKl=xzk.length;
var xZm=0;
var x6k=0;
var xdm, xFm, xIk;
while(xZm < xHm)
{
if( (xZm >= xKl) && (x6k == 0) )
{
x1h=xrl.substr(0,xHm-xZm)+x1h;
break;
}
xdm=this.xAk(xrl,xZm,xHl);
xFm=this.xAk(xzk,xZm,xHl);
xIk=xdm-xFm+x6k;
if(xIk >= 0)
{
x6k=0;
}
else
{
x6k=-1;
xIk += xel;
}
x1h=this.xNm(xIk, xHl)+x1h;
xZm += xHl;
}
return [x1h,x2k];
}
p4.xrk=function(s, xHl)
{
var x1h=[];
var x0l=s.length;
var xEl;
var xYm;
while(true)
{
if(x0l <= 0) break;
xEl=x0l-xHl;
if(xEl < 0) xEl=0;
xYm=s.substring(xEl,x0l);
xYm=xYm.replace(/^0+/,"");
x1h.push(parseInt(xYm));
x0l -= xHl;
}
return x1h;
}
p4.xgm=function(xrl, xzk)
{
xrl=this.xJk(xrl);
xzk=this.xJk(xzk);
var x1m=0;
var x1d=this.xbn(xrl);
xrl=x1d[0];
x1m += x1d[1];
x1d=this.xbn(xzk);
xzk=x1d[0];
x1m += x1d[1];
var x1h="";
var xHl=Math.floor((this.xNl-3)/2);
if(xHl < 1) xHl=1;
var xPk=Math.floor(1+(xrl.length-1)/xHl);
var xQk=Math.floor(1+(xzk.length-1)/xHl);
var x4m=xPk+xQk-1;
var xYk, xyk, xdl, xll, xCk, xql, xbm;
var x6k=0;
var xtl;


var xol=this.xrk(xrl,xHl);
var xNk=this.xrk(xzk,xHl);
for(xtl=0; xtl < x4m; xtl++)
{
xyk=xtl-xQk+1;
if(xyk < 0) xyk=0;
xdl=xtl+1;
if(xdl > xPk) xdl=xPk;
xCk=0;
xll=xtl-xyk;
for(xYk=xyk; xYk < xdl; xYk++)
{
var x7l=xol[xYk];
var xem=xNk[xll];
xCk += x7l*xem;
xll--;
}
xCk += x6k;
xql=this.xNm(xCk, xHl);
if(xql.length > xHl)
{
xbm=xql.length-xHl;
x6k=parseInt(xql.substr(0, xbm));
xql=xql.substr(xbm);
}
else
{
x6k=0;
}
x1h=xql+x1h;
}
if(x6k != 0)
{
x1h=(""+x6k)+x1h;
}
if(x1m != 0)
{
x1h += this.xwm(x1m);
}
return x1h;
}
p4.xfl=function(s, x2m)
{
var xTm, xWk;
if(x2m < 0)
{
xTm="";
xWk=this.xwm(-x2m)+s;
}
else if(x2m > s.length)
{
xTm=s+this.xwm(x2m-s.length);
xWk="";
}
else
{
xTm=s.substr(0,x2m);
xWk=s.substr(x2m);
}
return [xTm,xWk];
}
p4.xrm=function(xrl, xzk)
{
xrl=this.xJk(xrl);
xzk=this.xJk(xzk);
if(xrl.length < xzk.length)
{
var xjm=xrl;
xrl=xzk;
xzk=xjm;
}
var x1h="";
var x1d=this.xbn(xrl);
var xnm=x1d[1];
var x2m;
if(xnm > 0)
{
xrl=x1d[0];
x2m=xzk.length-xnm;
x1d=this.xfl(xzk,x2m);
x1h=x1d[1]+x1h;
xzk=x1d[0];
}
x1d=this.xbn(xzk);
xnm=x1d[1];
if(xnm > 0)
{
xzk=x1d[0];
x2m=xrl.length-xnm;
x1d=this.xfl(xrl,x2m);
x1h=x1d[1]+x1h;
xrl=x1d[0];
}
var xHl=this.xNl;
var xHm=xrl.length;
var xKl=xzk.length;
var xZm=0;
var x6k=0;
var xdm, xFm, xql, xbm;
while(xZm < xHm)
{
if( (xZm >= xKl) && (x6k == 0) )
{
x1h=xrl.substr(0,xHm-xZm)+x1h;
break;
}
xdm=this.xAk(xrl,xZm,xHl);
xFm=this.xAk(xzk,xZm,xHl);
xql=this.xNm(xdm+xFm+x6k, xHl);
if(xql.length > xHl)
{
xbm=xql.length-xHl;
x6k=parseInt(xql.substr(0, xbm));
xql=xql.substr(xbm);
}
else
{
x6k=0;
}
x1h=xql+x1h;
xZm += xHl;
}
if(x6k != 0)
{
x1h=(""+x6k)+x1h;
}
return x1h;
}
p4.x0m=function(xrl, xzm, xzk, xxk)
{
var x3k, x2k;
if(xzm == xxk)
{
x3k=this.xrm(xrl,xzk);
x2k=xzm;
}
else
{
var x1h=this.xCm(xrl,xzk);
x3k=x1h[0];
x2k=xzm;
if(x1h[1])
{
x2k=!x2k;
}
}
return [x3k,x2k];
}
p4.x4l=function(xzk)
{
var x3k=this.x0m(this.xxm, this.xal, xzk.xxm, xzk.xal);
var x1h=new xOm();
x1h.xQm(x3k[0],x3k[1]);
return x1h;
}
p4.xCl=function(xzk)
{
var x3k=this.x0m(this.xxm, this.xal, xzk.xxm, !xzk.xal);
var x1h=new xOm();
x1h.xQm(x3k[0],x3k[1]);
return x1h;
}
p4.xsk=function(xzk)
{
if(this.xal && (!xzk.xal)) return -1;
if(xzk.xal && (!this.xal)) return 1;
var x1h=this.xWl(this.xxm, xzk.xxm);
if(this.xal) x1h=-x1h;
return x1h;
}
p4.xQl=function(xzk)
{
var x2k=this.xal;
if(xzk.xal) x2k=!x2k;
var x0k=this.xgm(this.xxm, xzk.xxm);
var x1h=new xOm();
x1h.xQm(x0k,x2k);
return x1h;
}
p4.xXm=function(xzk)
{
var xBm=new xOm(this);
var xzl=xBm.xvl(xzk);

return [xBm,xzl];
}
p4.xSk=function(xzk)
{
var x1h=this.xXm(xzk);
return x1h[0];
}
p4.xBl=function(xzk)
{
var x1h=this.xXm(xzk);
return x1h[1];
}
p4.xkl=function(xzk)
{
return ((this.xxm == xzk.xxm) && (this.xal == xzk.xal));
}
p4.xEm=function(xwk)
{
this.xal=(xwk < 0.0);
if(this.xal)
{
xwk=-xwk;
}
this.xxm=this.xAm(xwk);
}
p4.xqk=function()
{
var x1h=this.xMk(this.xxm);
if( (!this.xAl()) && (this.xal) )
{
x1h=-x1h;
}
return x1h;
}
p4.xUm=function()
{
if(this.xal)
{
throw new Error("Not supported");
}
var xDk=new xOm(this);
var x1d;
var x1h=[];
var xml=new xOm("4294967296");
while(true)
{
x1d=xDk.xXm(xml);
xDk=x1d[0];
var xjl=xDk.xAl();
var xim=x1d[1].xqk();
for(var i=0; i < 4; i++)
{
if(xjl && (xim == 0)) break;
x1h.push(xim & 0xff);
xim >>= 8;
}
if(xjl) break;
}
x1h.reverse();

return x1h;
}

p4.xXl=function(xvm)
{
var xHk=3-((xvm.length+3)&3);
var x1d=[];
while(xHk-- > 0)
{
x1d.push(0);
}
x1d=x1d.concat(xvm);
var x1h=new xOm();
var x7k=new xOm("4294967296");
for(var xFk=0; xFk < x1d.length; xFk += 4)
{
x1h=x1h.xQl(x7k);
var xim=(x1d[xFk]<<24) | (x1d[xFk+1]<<16) | (x1d[xFk+2]<<8) | (x1d[xFk+3]);
if(xim < 0)
{
xim += 0x100000000;
}
var x4l=new xOm(xim);
x1h=x1h.x4l(x4l);
}
this.x7m(x1h);
}
p4.xRk=function(xYl, xFl)
{
if(this.xal || xYl.xal || xFl.xal)
{
throw new Error("Negative");
}
var xsl=new xOm(this);
var xpm=new xOm("2");
var xom=new xOm(xYl);
var xnl;
var x1h=new xOm("1");
while(true)
{
xnl=xom.xvl(xpm);
if(!xnl.xAl())
{
x1h=x1h.xQl(xsl);
x1h=x1h.xBl(xFl);
}
if(xom.xAl())
{
break;
}
xsl=xsl.xQl(xsl);
xsl=xsl.xBl(xFl);
}
return x1h;
}
p4.xTk=function()
{
return this.xal;
}

var p5=xqn.prototype;
p5.xvn=null;
p5.xpn=null;
p5.xrn=null;
function xqn()
{
}



p5.xOn=function(xAn, xkn)
{
var xRn=new xOm("1");
var xbi=xAn.xQl(xkn);
var xGn=xAn.xCl(xRn).xQl(xkn.xCl(xRn));
var xrd=new xOm(17);
var xSn=this.xun(xrd,xGn);
var xgn=xSn[2];
if(!xgn.xkl(xRn))
{
if(!xGn.xBl(xgn).xAl())
{
throw new Error("internal error");
}
throw new Error("not coprime");
}
var xhh=xSn[0];
if(xhh.xTk())
{
xhh=xhh.x4l(xGn);
}
if(xhh.xTk())
{
throw new Error("negative");
}
if(xhh.xsk(xGn) >= 0)
{
throw new Error("too large");
}
var xub=xhh.xQl(xrd).xBl(xGn);
if(!xub.xkl(xRn))
{
throw new Error("failed2");
}
return [xrd,xhh,xbi];
}
p5.xfn=function(xZm, xbi)
{
this.xpn=new xOm(xZm);
this.xvn=new xOm(xbi);
}
p5.xLn=function(xZm, xbi)
{
this.xrn=new xOm(xZm);
this.xvn=new xOm(xbi);
}
p5.xen=function()
{
return this.xpn;
}
p5.xHn=function()
{
return this.xrn;
}
p5.xIn=function()
{
return this.xvn;
}
p5.xEn=function()
{
if( (!this.xvn) || (!this.xrn) )
{
throw new Error("Need private key");
}
}
p5.xmn=function()
{
if( (!this.xvn) || (!this.xpn) )
{
throw new Error("Need public key");
}
}
p5.xFn=function(message)
{
this.xEn();
if(message.xsk(this.xvn) >= 0)
{
throw new Error("Message too large");
}
return message.xRk(this.xrn,this.xvn);
}
p5.xxn=function(message)
{
this.xmn();
if(message.xsk(this.xvn) >= 0)
{
throw new Error("Message too large");
}
return message.xRk(this.xpn,this.xvn);
}

p5.xun=function(xyn, xjn)
{
var xWj=new xOm(xyn);
var xqm=new xOm(xjn);
var x=new xOm();
var y=new xOm("1");
var xzn=new xOm("1");
var xon=new xOm();
while(!xqm.xAl())
{
var xdn=xWj.xXm(xqm);
var xBm=xdn[0];
xWj.x7m(xqm);
xqm=xdn[1];
var xwn=xzn.xCl(xBm.xQl(x));
var xNn=xon.xCl(xBm.xQl(y));
xzn=x;
xon=y;
x=xwn;
y=xNn;
}
var xub=xzn.xQl(xyn).x4l(xon.xQl(xjn));
if(!xub.xkl(xWj))
{
throw new Error("Failed3");
}
if(!xyn.xBl(xWj).xAl())
{
throw new Error("Failed4");
}
if(!xjn.xBl(xWj).xAl())
{
throw new Error("Failed5");
}
return [xzn, xon, xWj];
}

var p6=xGo.prototype;
function xGo()
{
}

p6.xXn=function(xbo)
{
this.x1n();
var xpo=xbo.length;
var xFk=0;
var xdo=xpo;
while(true)
{
if(xdo >= 64)
{
this.xVn(xbo.slice(xFk,xFk+64));
xdo -= 64;
xFk += 64;
}
else
{
this.xro(xbo.slice(xFk,xFk+xdo),xpo);
break;
}
}
return this.xCo(this.xYn);
}
p6.xAo=function(s)
{
var xio=this.xgo(s);
this.xXn(xio);
}
p6.xoo=function()
{
return this.xCo(this.xYn);
}
p6.x2n=function()
{
var xio=this.xCo(this.xYn);
return this.xso(xio);
}
p6.xso=function(xWj)
{
var x1h="";
for(var i=0; i < xWj.length; i++)
{
var xqm=xWj[i];
for(var xtl=0; xtl < 2; xtl++)
{
var xlo=(xqm >> 4)&0x0f;
if(xlo < 10)
{
x1h += String.fromCharCode(48+xlo);
}
else
{
x1h += String.fromCharCode(87+xlo);
}
xqm <<= 4;
}
}
return x1h;
}
//////////// private: ///////////////
p6.x1n=function()
{
this.xYn=[0x67452301, 0xEFCDAB89, 0x98BADCFE, 0x10325476, 0xC3D2E1F0];
}
p6.xWn=function(xBo)
{
if(xBo.length != 16)
{
throw new Error("Should be 16");
}
var xWh=[];
var i;
for(i=0; i < 16; i++)
{
xWh[i]=xBo[i];
}
for(i=16; i < 80; i++)
{
xWh[i] = this.xno(xWh[i-3] ^ xWh[i-8] ^ xWh[i-14] ^ xWh[i-16], 1);
}
var xjo=this.xYn.slice(0);
var xwk, x0n, xyo;
for(i=0; i < 80; i++)
{
if(i < 20)
{
xwk = (xjo[1] & xjo[2]) | ((xjo[1]^0xffffffff) & xjo[3]);
x0n = 0x5A827999;
}
else if(i < 40)
{
xwk = xjo[1] ^ xjo[2] ^ xjo[3];
x0n = 0x6ED9EBA1;
}
else if(i < 60)
{
xwk = (xjo[1] & xjo[2]) | (xjo[1] & xjo[3]) | (xjo[2] & xjo[3]);
x0n = 0x8F1BBCDC;
}
else
{
xwk = xjo[1] ^ xjo[2] ^ xjo[3];
x0n = 0xCA62C1D6;
}
xyo = (this.xno(xjo[0], 5)+xwk+xjo[4]+x0n+xWh[i]) & 0xffffffff;
xjo[4] = xjo[3];
xjo[3] = xjo[2];
xjo[2] = this.xno(xjo[1], 30);
xjo[1] = xjo[0];
xjo[0] = xyo;
}
for(i=0; i < 5; i++)
{
xyo=this.xYn[i]+xjo[i];
xyo &= 0xffffffff;
this.xYn[i]=xyo;
}
}
p6.xVn=function(xbo)
{
if(xbo.length != 64)
{
throw new Error("Should be 64");
}
var x5n=this.xZn(xbo);
this.xWn(x5n);
}
p6.xro=function(xbo, xto)
{
var xco=xto & 63;
var xho=xbo.slice(0,xco);
xho.push(128);
if(xho.length < 56)
{
while(xho.length < 56)
{
xho.push(0);
}
}
else
{
while(xho.length < 120)
{
xho.push(0);
}
}
xto *= 8;
var xmo=this.xCo([Math.floor(xto/0x100000000), xto&0xffffffff]);
xho=xho.concat(xmo);
if(xho.length == 64)
{
this.xVn(xho);
}
else
{
this.xVn(xho.slice(0,64));
this.xVn(xho.slice(64,128));
}
}
p6.xno=function(xqm, x9n)
{
xqm &= 0xffffffff;
var x1h=this.xao(xqm, x9n);
var xub=this.xao(x1h, -x9n);
if(xqm != xub)
{
throw new Error("Failed");
}
return x1h;
}
p6.xao=function(xqm, x9n)
{
x9n &= 31;
if(x9n == 0) return xqm;
var x1h=(xqm << x9n)&0xffffffff;
var xko=32-x9n;
var x3n=0x7fffffff >> (xko-1);
var xEo=(xqm >> xko)&x3n;
x1h |= xEo;
return x1h;
}
p6.xZn=function(xbo)
{
if(xbo.length & 3)
{
throw new Error("Should be multiple of 4");
}
var x5n=[];
var xul=0;
var i=0;
while(i < xbo.length)
{
xul <<= 8;
xul |= (xbo[i] & 0xff);
i++;
if( (i & 3) == 0)
{
x5n.push(xul);
xul=0;
}
}
return x5n;
}
p6.xCo=function(xBo)
{
var xio=[];
var xWh, i, xzo;
for(i=0; i < xBo.length; i++)
{
xWh=xBo[i];
xio.push((xWh >> 24)&0xff);
xio.push((xWh >> 16)&0xff);
xio.push((xWh >> 8)&0xff);
xio.push((xWh)&0xff);
}
return xio;
}
p6.xgo=function(s)
{
var x1h=[];
for(var i=0; i < s.length; i++)
{
x1h=x1h.concat(this.xxo(s.charCodeAt(i)));
}
return x1h;
}
p6.xxo=function(xfk)
{
var x1h;
if(xfk <= 0x7f)
{
x1h=[xfk];
}
else if(xfk <= 0x07ff)
{
x1h=[0xc0|((xfk>>6)&0x1f), 0x80|(xfk&0x3f)];
}
else if(xfk <= 0xffff)
{
x1h=[0xc0|((xfk>>12)&0x0f), 0x80|((xfk>>6)&0x3f), 0x80|(xfk&0x3f)];
}
else if(xfk <= 0x1fffff)
{
x1h=[0xc0|((xfk>>18)&0x07), 0x80|((xfk>>12)&0x3f), 0x80|((xfk>>6)&0x3f), 0x80|(xfk&0x3f)];
}
else if(xfk <= 0x3ffffff)
{
x1h=[0xc0|((xfk>>24)&0x03), 0x80|((xfk>>18)&0x3f), 0x80|((xfk>>12)&0x3f), 0x80|((xfk>>6)&0x3f), 0x80|(xfk&0x3f)];
}
else
{
x1h=[0xc0|((xfk>>30)&0x01), 0x80|((xfk>>24)&0x3f), 0x80|((xfk>>18)&0x3f), 0x80|((xfk>>12)&0x3f), 0x80|((xfk>>6)&0x3f), 0x80|(xfk&0x3f)];
}
return x1h;
}

var p7=xWo.prototype;
function xWo()
{
this.xTo="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";
}

p7.xUo=function(xio)
{
var x1h="";
var xpo=xio.length;
var xPg=0;
var x0l;
while(xPg < xpo)
{
x0l=xPg+3;
if(x0l > xpo) x0l=xpo;
x1h += this.xRo(xio.slice(xPg,x0l));
xPg=x0l;
}

return x1h;
}
p7.xYo=function(xKm)
{
var x1h=[];
if( (xKm.length % 4) != 0)
{
this.x4o();
}
var xPg=0;
var xXo;
while(xPg < xKm.length)
{
xXo=this.xSo(xKm.substr(xPg,4));
x1h=x1h.concat(xXo);
xPg += 4;
}
return x1h;
}
p7.xRo=function(xio)
{
var x1h="";
var xlo=xio[0] >> 2;
x1h += this.xTo.substr(xlo,1);
var xqm;
if(xio.length < 2)
{
xqm=0;
}
else
{
xqm=xio[1];
}
xlo=((xio[0] & 0x03) << 4) | (xqm >> 4);
x1h += this.xTo.substr(xlo,1);
if(xio.length < 2)
{
x1h +="==";
}
else
{
if(xio.length < 3)
{
xqm=0;
}
else
{
xqm=xio[2];
}
xlo=((xio[1] & 0x0f) << 2) | (xqm >> 6);
x1h += this.xTo.substr(xlo,1);
if(xio.length < 3)
{
x1h +="=";
}
else
{
xlo=xqm & 0x3f;
x1h += this.xTo.substr(xlo,1);
}
}
return x1h;
}
p7.xSo=function(xKm)
{
if(xKm.length != 4)
{
this.x4o();
}
var x1h=[];
var xVo=this.xPo(xKm.charCodeAt(0));
var xOo=this.xPo(xKm.charCodeAt(1));
x1h[0]=(xVo << 2) | (xOo >> 4);
var i=xKm.charCodeAt(2);
if(i != 61)
{
xVo=xOo;
xOo=this.xPo(i);
x1h[1]=((xVo & 0x0f) << 4) | (xOo >> 2);
i=xKm.charCodeAt(3);
if(i != 61)
{
xVo=xOo;
xOo=this.xPo(i);
x1h[2]=((xVo & 0x03) << 6) | xOo;
}
}
return x1h;
}
p7.xPo=function(xQo)
{
if( (xQo >= 65) && (xQo <= 90))
{
return xQo-65;
}
else if( (xQo >= 97) && (xQo <= 122))
{
return xQo-71;
}
else if( (xQo >= 48) && (xQo <= 57))
{
return xQo+4;
}
else if(xQo == 43)
{
return 62;
}
else if(xQo == 47)
{
return 63;
}
this.x4o();
return 0;
}
p7.x4o=function()
{
throw new Error("Faulty Base64 data");
}

var p8=xqp.prototype;
function xqp()
{
this.xvp=new xqn();
this.xsp=new xGo();
this.xip=new xWo();
}

p8.xpp=function(message, x6o)
{
this.xvp.xEn();
if(x6o)
{
this.xvp.xmn();
}
this.xsp.xAo(message);
var x6n=this.xsp.xoo();
var xbi=this.xvp.xIn();
var xkp=xbi.xUm();
var xbp=xkp.length-1;
if(x6n.length > xbp)
{
throw new Error("Key too short");
}
var xlp="";
while(x6n.length < xbp)
{
var xZd=Math.floor(Math.random()*255);
x6n[x6n.length]=xZd;
xlp += xZd+",";
}
var x7o=new xOm();
x7o.xXl(x6n);
var xln=this.xvp.xFn(x7o);
if(x6o)
{
var xnp=this.xvp.xxn(xln);
if(! xnp.xkl(x7o))
{
throw new Error("Internal error");
}
}
var xjp=xln.xUm();
var xtp=this.xip.xUo(xjp);
return xtp;
}
p8.x6o=function(message, xYb)
{
this.xvp.xmn();
var xhp=this.xip.xYo(xYb);
var xup=new xOm();
xup.xXl(xhp);
var xnp=this.xvp.xxn(xup);
var xep=xnp.xUm();
this.xsp.xAo(message);
var x6n=this.xsp.xoo();
if(xep.length < x6n.length) return false;
for(var i=0; i < x6n.length; i++)
{
if(xep[i] != x6n[i]) return false;
}
return true;
}
p8.xfn=function(xZm, xbi)
{
this.xvp.xfn(xZm, xbi);
}
p8.xLn=function(xZm, xbi)
{
this.xvp.xLn(xZm, xbi);
}

